---
title: How to create rules to execute behaviors with Rules Engine for Firewall
description: >-
  Integrate rules in your firewall to set tasks to be executed for specific
  scenarios without changing your existing code.
meta_tags: 'secure, rules engine, firewall, criteria, behavior'
namespace: docs_secure_work_rules_engine
permalink: /documentation/products/guides/secure/work-with-rules-engine/
---

import Tabs from '~/components/tabs/Tabs'
import Code from '~/components/Code/Code.astro'


Implementing rules in your firewall using [Rules Engine](/en/documentation/products/secure/edge-firewall/rules-engine/) will allow you to determine the rules it should execute in specific scenarios.

This guide demonstrates the process of creating a rule with a practical example of verifying the existence of a certificate and returning a custom response when there isn't one. This behavior is useful in scenarios such as adjusting your policies to comply with BACEN requirements.

:::note
There are different criteria that require different Firewall modules. Make sure you have the [right module](/en/documentation/products/secure/edge-firewall/rules-engine/#criteria) activated to create your rules.
:::

---

<Tabs client:visible>
    <Fragment slot="tab.console">Console</Fragment>
    <Fragment slot="tab.api">API</Fragment>

<Fragment slot="panel.console">
To create a rule:

1. Access [Azion Console](/en/documentation/products/guides/how-to-access-azion-console/) > **Firewall**.
2. Select the firewall in which you want to configure the rule.
3. Click the **Rules Engine** tab.
4. Click the **+ Rule** button.
5. Give your rule a name and, optionally, a description.
6. In the **Criteria** section, select the `SSL Verification Status` variable.
7. As a comparison operator, select `is esqual`.
8. As an argument, select `Missing Client Certificate`.
9. In the **Behaviors** section, select **Set Custom Response**.
10. As arguments:
    - On **Status Code**, add `401`.
    - On **Content Type**, add the content and header description. Example: `application/json`.
    - On **Content Body**, pass the message you want to present to users.
11. Click the **Save** button.
</Fragment>

<Fragment slot="panel.api">
1. Run the following `POST` request to create a rule, replacing `[TOKEN VALUE]` with your [personal token](/en/documentation/products/guides/personal-tokens/) and the `<edge_firewall_id>` variable with your firewall id value:

<Code lang="bash" code={`
curl --request POST \
  --url https://api.azion.com/v4/edge_firewall/firewalls/<edge_firewall_id>/request_rules \
  --header 'Accept: application/json' \
  --header 'Authorization: Token [TOKEN VALUE]' \
  --header 'Content-Type: application/json' \
  --data '{
    "name": "SSL Verification",
    "active": true,
    "criteria": [
      [
        {
          "conditional": "if",
          "variable": "\${ssl_verification_status}",
          "operator": "is_equal",
          "argument": "MISSING_CLIENT_CERTIFICATE"
        }
      ]
    ],
    "behaviors": [
      {
        "type": "set_custom_response",
        "attributes": {
          "status_code": 401,
          "content_type": "application/json",
          "content_body": "{}"
        }
      }
    ]
  }'
`} />


| Key | Description |
| --- | --- |
| `name` | Name of the rule |
| `description` | Description of the rule |
| `behaviors` | Array that stores objects that define behaviors |
| `criteria` | Array that stores objects that define criteria |

See the [Azion API documentation](https://api.azion.com/) to find out more about criteria and behavior objects.

2. You'll receive the following response:

<Code lang="json" code={`
{
  "results": {
    "name": "SSL Verification",
    "is_active": true,
    "behaviors": [
      {
        "status_code": 401,
        "content_body": "{}",
        "name": "set_custom_response",
        "content_type": "application/json"
      }
    ],
    "criteria": [
      [
        {
          "variable": "ssl_verification_status",
          "operator": "is_equal",
          "conditional": "if",
          "argument": "MISSING_CLIENT_CERTIFICATE"
        }
      ]
    ],
    "last_modified": "2023-11-23T23:54:14.941097Z",
    "last_editor": "your-email@example.com",
    "id": <id>,
    "order": 2
  },
  "schema_version": 3
}
`} />

3. Wait a few minutes for the changes to propagate.

:::tip
Check the [Azion API documentation](https://api.azion.com/) to know more about all features available via API.
:::
</Fragment>

</Tabs>
---

