---
title: How to investigate requests with Real-Time Events GraphQL API
description: Perform an investigation on requests that are possible attacks with the Real-Time Events GraphQL API.
meta_tags: azion, edge, observe, observability, logs, investigation, attacks
namespace: docs_investigate_requests
permalink: /documentation/products/guides/observe/investigate-requests-graphql-api/
menu_namespace: observeMenu
---

import Button from '~/components/Button.astro'

Constant monitoring can help you identify unusual behaviors in your applications and possible attacks. For this guide, you'll use an example scenario where there are requests coming from Brazil, a country you don't want to allow access to, and you want to filter requests from Chile, the country most of your safe requests come from.

:::tip
Change the countries in this example to the ones that best fit your application and investigation scenario.
:::

See the steps described in this guide to perform an investigation on requests and next steps to resolve the situation it if you're receiving an attack.

## Using GraphQL API playground for initial investigation

1. Make sure you're logged in on your Azion account, via [Real-Time Manager](https://manager.azion.com/) or via [Console](https://console.azion.com/).
2. Access Real-Time Events GraphQL API [playground](https://manager.azion.com/events/graphql).
3. Create a query with the filter and time range you want to use, such as this one:

```graphql
query requestsInvestigation {
  httpEvents(
    limit: 100,
    filter: {
      tsRange: {begin:"2024-03-20T10:10:10", end:"2024-03-30T10:10:10"}

      geolocCountryNameNotIn: ["Chile"]
      hostIn: ["myhost.net", "anotherhost.com"]
    }
    aggregate: {count: geolocCountryName}
    groupBy: [host, geolocCountryName, requestUri, status]
    orderBy: [count_DESC]
  )
  {
    geolocCountryName
    host
    requestUri
    status
    count
  }
}
```

4. Run the query in the GraphQL API playground.
5. Analyze the query response and check if there's incoming requests from the countries you don't want to allow, in this case, from Brazil.
    - You'll receive a response similar to:

```json

```

If you're running a general investigation query, you can check if the same country that doesn't usually access your application made an abnormal amount of request to you host in a short amount a time, as in the same minute. This is a common indicator you're application is under attack.

:::tip
Check how many request the second-ranked country made to compare against the first-ranked one to decide if it's a threat.
:::

## Creating a network list

As you've identified a country you don't want to allow access to is accessing your application, you can create a [network list](/en/documentation/products/secure/edge-firewall/network-layer-protection/network-lists/) to block the country.

1. Access [Azion Console](https://console.azion.com/) > **Network Lists**.
2. Click **+ Network List**.
3. Give your network list a unique and easy-to-remember name.
4. In **Type**, choose **Countries**.
5. In **Countries**, select the countries you want to add to the list. In this case, **Brazil**.

To have your network list running, you need to go to **Edge Firewall** > **Rules Engine** and create a rule associated with the network list you've just created.

<Button href="/en/documentation/products/guides/blocklists-ip-addresses-edge/#associate-network-list-with-edge-firewall-rule-set" text="go to associate network list to rule guide" variant="secondary" target="_blank"></Button>

After the propagation time for the rule, your domain, associated with the edge firewall you added the list to, will block all requests from that country, which in this case, is Brazil.

## Monitoring on playground again

After creating the rule on **Rules Engine for Edge Firewall**, you need to continue monitoring your application traffic to guarantee the rule has been applied and the application traffic is normalized.

In your query, update the `tsRange` to match the period after you've created the rule. Remember to give the time for it to propagate.

Now, in the query response for the example of this guide, the requests coming from Brazil must have a `status` indicating blocking, such as `403`.

```graphql
query requestsInvestigation {
  httpEvents(
    limit: 100,
    filter: {
      tsRange: {begin:"2024-03-20T10:10:10", end:"2024-03-30T10:10:10"}

      geolocCountryNameNotIn: ["Chile"]
      hostIn: ["myhost.net", "anotherhost.com"]
      statusIn: "403"

    }
    aggregate: {count: geolocCountryName}
    groupBy: [host, geolocCountryName, requestUri, status]
    orderBy: [count_DESC]
  )
  {
    geolocCountryName
    host
    requestUri
    status
    count
  }
}
```

---

## Other secure configuration options

If you don't want to block all requests from a country through a network list, there are other features of Azion [Secure products](/en/documentation/products/secure/overview/) you can use.

- [Create a Set Rate Limit rule]().
- Use [Tuning]() on WAF to monitor and create specific allowed rules.
- [Create a rule with the criteria `if Header User Agent matches --`]()

If you use other configurations, modify your GraphQL API query filters to match the other configurations. For example, using the `stacktrace` field or adding another status, such as `429` for the Set Rate Limit rule.

---

## Other monitoring queries

Here are some other options of queries you can use to investigate and monitor attacks.

**ASN query**

```graphql

```

**User-Agent query**

```graphql

```

