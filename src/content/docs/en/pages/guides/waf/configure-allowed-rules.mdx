---
title: How to configure a WAF Custom Allowed Rule
description: >-
  Configuring a WAF Custom Allowed Rule allows you to instantiate specific rules
  for the needs of your edge application.
meta_tags: 'secure, WAF, WEB Application Firewall, cybersecurity, threats'
namespace: docs_guides_configure_waf_allowed_rules
permalink: /documentation/products/guides/secure/configure-waf-allowed-rules/
menu_namespace: secureMenu
---

import LinkButton from 'azion-webkit/linkbutton'
import Tabs from '~/components/tabs/Tabs'
import Code from '~/components/Code/Code.astro'
import Apiv4Rollout from '~/includes/snippets/apiv4Rollout/en/snippet.mdx'

<Apiv4Rollout />

Configuring a **WAF Custom Allowed Rule** allows you to instantiate specific rules for the needs of your edge application. These rules permit specific, legitimate traffic while maintaining robust protection against malicious attacks.

This guide explains how to configure a WAF Custom Allowed Rule.

:::tip
If you're not sure which steps apply to your account, see [this guide](/en/documentation/products/guides/verify-account-migration/) to determine if your account has already been migrated.
:::

<LinkButton link="/en/documentation/products/secure/edge-firewall/web-application-firewall/custom-allowed-rules/" text="go to Custom Allowed Rules reference" severity="secondary" />

---

## Requirements

To instantiate Custom Allowed Rules in a WAF Rule Set, you must have:

- An [edge firewall](/en/documentation/products/guides/secure/edge-firewall-configure-main-settings/) with the Web Application Firewall module activated.
- A configured [WAF Rule Set](/en/documentation/products/guides/secure/create-waf-rule-set/).

---

## Configuring a WAF Custom Allowed Rule

<Tabs client:visible>
    <Fragment slot="tab.consoleworkloads">Console - Workloads</Fragment>
    <Fragment slot="tab.consoledomain">Console - Domains</Fragment>
    <Fragment slot="tab.apiv4">API v4</Fragment>
    <Fragment slot="tab.apiv3">API v3</Fragment>

<Fragment slot="panel.consoleworkloads">

To configure WAF Custom Allowed Rules via Workloads:

1. Access [Azion Console](/en/documentation/products/guides/how-to-access-azion-console/) > **Workloads**.
2. Select your workload.
3. Navigate to **Security Settings**.
4. In **WAF Rules**, click **+ WAF Rule Set** or select an existing one.
5. In the **Allowed Rules** section, click **+ Allowed Rule**.
6. Configure the allowed rule:
   - **Rule ID**: select the rule you want to allow.
   - **Description**: explain why this rule was allowed.
   - **Path**: specify the path pattern (e.g., `/api/v1/resources/*`).
   - **Match Zones**: select request parts to match (headers, body, etc.).
7. Click **Save**.

:::note
With Workloads, WAF rules are automatically applied to your security configuration.
:::

</Fragment>

<Fragment slot="panel.consoledomain">

To configure WAF Custom Allowed Rules via traditional Domains interface:

1. Access [Azion Console](/en/documentation/products/guides/how-to-access-azion-console/) > **WAF Rules** in **Edge Libraries**.
2. Create a [new WAF Rule Set](/en/documentation/products/secure/edge-firewall/web-application-firewall/rules-set/) or select an existent one.
3. Select the **Allowed Rules** tab.
4. Click the **+ Allowed Rule** button. 
5. Select the **Rule ID** you want to use.
    - Check the list of all [available internal rules](/en/documentation/products/secure/edge-firewall/web-application-firewall/rules-set/).
6. Type a description to explain the reason this rule was allowed.
7. In the **Match Zone Set** section configure the behavior that should be used to allow a rule:
    - In **Path**, configure the behavior that should be used to allow a rule. Example: `/api/v1/resources/*`.
    - In **Match Zones**, select the part of the request to match such as headers, body, etc.
        - According to the option, you could complete additional fields to add a specific value representing the match option and the matches for the value or the key name. Read more about [Allowed Rules fields](/en/documentation/products/secure/edge-firewall/web-application-firewall/#allowed-rules).
    - If necessary, activate the **Regex** switch to treat conditional fields as regular expressions in all match zones. 
8. Enable the **Status** switch.
9. Click the **Save** button.

</Fragment>

<Fragment slot="panel.apiv4">

To configure WAF Custom Allowed Rules via API v4:

<Code lang="bash" code={`curl --request POST \\\\
  --url https://api.azion.com/v4/waf/rule_sets/<rule_set_id>/allowed_rules \\\\
  --header 'Accept: application/json' \\\\
  --header 'Content-Type: application/json' \\\\
  --header 'Authorization: Token [TOKEN VALUE]' \\\\
  --data '{
    "rule_id": 12345,
    "description": "Allow API requests",
    "match_zones": [
      {
        "zone": "path",
        "zone_input": "/api/v1/resources/*"
      }
    ]
  }'`} />

:::tip
Check the [WAF API v4 documentation](https://api.azion.com/v4#/operations/PostWafAllowedRules) for more details.
:::

</Fragment>

<Fragment slot="panel.apiv3">

To configure WAF Custom Allowed Rules via API v3:

<Code lang="bash" code={`curl --request POST \\\\
  --url https://api.azionapi.net/waf/rulesets/<ruleset_id>/allowed_rules \\\\
  --header 'Accept: application/json; version=3' \\\\
  --header 'Content-Type: application/json' \\\\
  --header 'Authorization: Token [TOKEN VALUE]' \\\\
  --data '{
    "rule_id": 12345,
    "description": "Allow API requests",
    "path": "/api/v1/resources/*",
    "match_zones": [
      "HEADERS",
      "BODY"
    ]
  }'`} />

:::tip
Check the [WAF API v3 documentation](https://api.azionapi.net/api/v3#/WAF) for complete details.
:::

</Fragment>

</Tabs>

:::tip
You can configure a Custom Allowed Rule based on the WAF Tuning records. Consult the guide on [How to tune WAF](/en/documentation/products/guides/secure/tune-waf/) for more information.
:::


