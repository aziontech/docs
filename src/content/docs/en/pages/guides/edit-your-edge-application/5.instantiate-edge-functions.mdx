---
title: Instantiate edge functions
description: insert later
meta_tags: build
namespace: docs_guides_build_instantiate_edge_functions
permalink: /documentation/products/guides/build/instantiate-edge-functions/
menu_namespace: buildMenu
---

import Button from '~/components/Button.astro'

Instantiate serverless functions directly within your edge application. 

<Button href="link_ef_inst" variant="secondary" text="Go to Edge Functions Instances documentation"></Button>

:::caution[warning]
You must activate the [Edge Functions](link_app_accel) module to implement functions in your application. If **Edge Functions** is activated, computing time and invocations could generate usage-related costs. Check the [pricing page](https://www.azion.com/en/pricing/) for more information.
:::

To run a function, you must have:

- An [Azion account](link_accounts).
- An [edge application](link_build_with_edge_app).
- An [Azion domain](link_config_domain).

:::tip
For this guide, you can use any function already available on [Azion Marketplace](https://marketplace.azion.com/) or create your own. Check the guide on [How to build an API with Edge Functions and ChatGPT](/en/documentation/products/guides/edge-functions/api-builder/) for an example of a function you can run in your application. 
:::

You can instantiate edge functions through [Real-Time Manager (RTM)](#via-rtm) or the [Azion API](#via-api).

## Via RTM

In this section, you'll instantiate a function for your application. To enable this functionality, you must first activate the **Edge Functions** module:

1. [Access RTM](link_rtm).
2. On the upper-left corner of the page, open the **Products menu**, represented by three horizontal lines, and select **Edge Application**.
3. Click the edge application you want to configure. 
4. Activate the **Edge Functions** module to enable functions.
5. Click the **Save** button.

Now you're able to instantiate edge functions. You can [create a function using Edge Functions](link_develop_function), but this guide will use the pre-configured *Azion - Hello World* function, a global function included in all Azion accounts.

To instantiate the *Hello World* function, still on the **Edge Application** page:

1. Go to the **Functions** tab.
2. Click **Add Function**.
3. Name your function instance. For example: `Hello World function`.
4. Select the **Azion - Hello World** function.
5. Click the **Save** button.

The functions page now lists the newly created instance. However, this new function isn't yet active in your application. You need to define what will trigger the function in your application. For this, you can use your edge application's **Rules Engine**.

The instructions below will help you create a rule in which any request from your users to `xxxxxxxxxx.map.azionedge.net/hello-world` will invoke the instantiated function.

1. Still on the **Edge Application** page, navigate to the **Rules Engine** tab.
2. Click the **Add Rule** button and select **Request Phase**.
3. Under the **Criteria** section, select the variable `${uri}`.

:::note
The `${uri}` variable may already be selected by default if you didn't activate **Application Acceleration**. For more information on Edge Application modules, see [Modules](link_modules).
:::

4. As a comparison operator, select **is equal**.
5. As an argument, add `/hello-world`.
6. In the **Behaviors** section, select **Run Function** from the behavior list.
7. Select the **Hello World** function.
8. Click the **Save** button.

To see your function running, access your application using its domain and the URI set in the rule, which is in the format `xxxxxxxxx.map.azionedge.net/hello-world`.

## Via API

This section contains a sequence of Client URL (cURL) commands you can run in a command terminal or in an API platform of your choosing. 

Before you run the Azion API, you'll need to [generate a personal token](link_personal_token) for your account. You also need to [retrieve your edge application ID](link_configure_edge_app) to run the following requests.

With your token and edge application ID in hand, follow the steps to instantiate an edge function via API:

1. Run the following `PATCH` request in your terminal, replacing `[TOKEN VALUE]` with your personal token and the `<edge_application_id>` variable with the `id` of your edge application to activate the [Edge Functions](link_edge_functions) module:

```bash
curl --location --request PATCH 'https://api.azionapi.net/edge_applications/<edge_application_id>' \
--header 'Accept: application/json; version=3' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token [TOKEN VALUE]' \
--data '{
    "edge_functions": true
}'
```

2. You'll receive a response with the updated value.
3. Run the following `GET` request to retrieve the `edge_function_id` of the *Hello World* function:

```bash
curl --location 'https://api.azionapi.net/edge_functions' \
--header 'Accept: application/json; version=3' \
--header 'Authorization: Token [TOKEN VALUE]' \
```

4. You'll receive a response similar to this:

```json
{
  ...
  "results": [
    {
      "id": <edge_function_id>,
      "name": "Azion - Hello World",
      "language": "javascript",
      "code": "\r\nasync function handleRequest(request) {\r\n    return new Response(\"Hello World!\",{status:200})\r\n}\r\n\r\naddEventListener(\"fetch\", event => {\r\n    event.respondWith(handleRequest(event.request))\r\n})\r\n\r\n",
      "json_args": {},
      "function_to_run": "handleRequest",
      "initiator_type": "edge_application",
      "active": true,
      "last_editor": "azionmanager@azion.com",
      "modified": "2021-08-10T17:49:26.224184Z",
      "is_proprietary_code": false,
      "reference_count": 4,
      "version": "-",
      "vendor": "azionmanager@azion.com"
    }
  ]
}
```

5. Copy the `<edge_function_id>` value.
6. Run the following `POST` request, replacing the edge function ID value with the value you received in the previous response:

```bash
curl --location 'https://api.azionapi.net/edge_applications/<edge_application_id>/functions_instances' \
--header 'Accept: application/json; version=3' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token [TOKEN VALUE]' \
--data '{
  "name": "Hello World",
  "edge_function_id": <edge_function_id>,
  "args": {}
}'
```

7. You'll receive a response similar to this:

```json
{
    "results": {
        "edge_function_id": <edge_function_id>,
        "name": "Hello World",
        "args": {},
        "id": <edge_function_instance_id>
    }
}
```

  | Key | Description |
  | --- | --- |
  | `edge_function_id` | The ID of the edge function. This is not the same as the ID of the instantiated function, which is unique for each application's function instance. |
  | `name` | Name of the instantiated function. |
  | `args` | Definition of arguments required for the function. Some functions don't take arguments. |
  | `id` | ID of the instantiated function. |
  
8. Run the following `POST` request in your terminal, replacing `[TOKEN VALUE]` with your personal token, the `<edge_application_id>` variable with the `id` of your edge application, and the `<edge_function_instance_id>` variable with the function instance ID received in the previous response:

```bash
curl --location 'https://api.azionapi.net/edge_applications/<edge_application_id>/rules_engine/request/rules' \
--header 'Accept: application/json; version=3' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token [TOKEN VALUE]' \
--data '{
    "name": "Set cache setting - /cache",
    "behaviors": [
        {
            "name": "run_function",
            "target": "<edge_function_instance_id>"
        }
    ],
    "criteria": [
        [
            {
                "variable": "${uri}",
                "operator": "is_equal",
                "conditional": "if",
                "input_value": "/hello-world"
            }
        ]
    ]
}'
```

:::note
For more information on the rules endpoint, see [Work with Rules Engine](link_work_rules).
:::

9. You'll receive a response similar to this, confirming your function was created successfully:

```json
{
    "results": {
        "id": <rule_id>,
        "name": "Run function - /hello-world",
        "phase": "request",
        "behaviors": [
            {
                "name": "run_function",
                "target": "<edge_function_instance_id>"
            }
        ],
        "criteria": [
            [
                {
                    "variable": "${uri}",
                    "operator": "is_equal",
                    "conditional": "if",
                    "input_value": "/hello-world"
                }
            ]
        ],
        "is_active": true,
        "order": 2,
        "description": ""
    }
}
```

10. Wait a few minutes for the changes to propagate.

To see your function running, access your application using its domain and the URI set in the rule, which is in the format `xxxxxxxxx.map.azionedge.net/hello-world`.

:::tip
Check the [Azion API documentation](link_azionapi) and the [OpenAPI specification](link_openapi) to know more about what the Azion API can offer.
:::
