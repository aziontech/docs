---
title: Tune your cache settings
description: insert later
meta_tags: build
namespace: docs_guides_build_tune_cache_settings
permalink: /documentation/products/guides/build/tune-cache-settings/
---

Adjust your edge application's cache strategy, including expiration values at the edge or browser level, file slicing to break large files into smaller chunks, and cache key segmentation based on query strings or cookies.

To modify your application's cache settings, you need:

- An [Azion account](link_accounts).
- An [edge application](link_build_with_edge_app).
- An [Azion domain](link_config_domain).

You can configure your application's cache settings using [Real-Time Manager (RTM)](#via-rtm) or the [Azion API](#via-api).

## Via RTM

In this section, you'll add a new configuration for your application's cache. You can choose to modify your **Default Cache Setting**, which is already listed and activated by default in your application, or create a new one. 

:::note
This guide describes the process of creating and activating a new cache setting in your application for a specific scenario. However, if you want to modify cache settings for your entire application, you can choose to modify your default cache setting instead of creating a new one. In this case, you won't need to create or activate a new cache setting instance using **Rules Engine**, since the *default rule* already activates your setting.
:::

To create a new cache setting instance:

1. [Access RTM](link_rtm).
2. On the upper-left corner of the page, open the **Products menu**, represented by three horizontal lines, and select **Edge Application**.
3. Click the edge application you want to configure. 
4. Activate the **Application Acceleration** module to unlock advanced cache key configurations.
5. Navigate to the **Cache Settings** tab.
6. Click the **Add Cache Settings** button.
7. Give your cache setting a name.

The following steps will guide you through tuning a new entry of edge application's cache settings. You can customize your expiration settings, slice settings, advanced cache key, and adaptive delivery to your liking. This guide will go over each option available to you, but you can choose which configuration will be altered in the cache setting depending on the needs of your application.

To start, you can customize how long objects should remain in cache. You can customize the cache Time To Live (TTL) in browsers and at the edge. This data is sent in requests and responses through the `Cache-Control` and `Expires` HTTP headers. 

:::note
The TTL determined by the `max-age` directive in `Cache-Control`. If `Cache-Control` not present in the request or response, the timestamp sent in the `Expires` header determines the cache TTL. 
:::

You can choose to keep **Honor Origin Cache Headers** selected to respect the TTL values sent in the headers by the origin or the application itself. To override the values sent in these HTTP headers to the user:

1. In **Browser Cache Settings**, select **Override Cache Settings** to determine a custom TTL value.
2. Add the TTL in seconds in the **Maximum TTL (seconds)** field.

:::note
The maximum TTL value for browsers should be between 0 and 31536000 seconds (3 years). 
:::

In **CDN Cache Settings**, you can determine whether the edge should abide by the values sent in the `Cache-Control` and `Expires` headers.

You can choose to keep **Honor Origin Cache Headers** selected to respect the TTL values sent in the headers by the origin or the application itself.

If your application is not sending `Cache-Control` and `Expires` headers or the values are not set correctly, you can determine a default maximum TTL for the cache to be maintained at the edge in the **Default TTL (seconds)** field. If your application ins sending these valoues, to override them you can:

3. In **CDN Cache Settings**, select **Override Cache Settings** to determine a custom TTL value.
4. Add the TTL in seconds in the **Maximum TTL (seconds)** field.

:::note
The maximum and default TTL values for the edge should be between 60 and 31536000 seconds (3 years). If you have the [Application Acceleration](link_app_accel) module activated, you can set this value to a minimum of 0. Additionally, if you have the [L2 Caching](link_l2) module activated and wish to maintain cache in the L2, you must set TTL to at least 3 seconds.
A TTL zero does is not the same as a cache bypass. For more details, read about the difference between these settings on the [Bypass cache](/en/documentation/products/edge-application/rules-engine/#difference-between-bypass-cache-and-ttl-0) documentation.
:::

Next, you can implement file slicing for large files. Instead of downloading a large content file and risking timeouts or connection terminations, the file is sliced in pieces and cache the content on-demand to implement file slicing for large files:

5. In **Slice Settings**, enable the switch for **Slice Configuration**.
6. The **Edge caching** layer is already selected by default. If you have the **L2 Caching** module activated, you can also enable slicing for the L2.

The slice range is of 1024KB by default.

The next step is to customize how your content will be cached at the edge through [cache keys](link_ref_cache). You can choose to segment cache keys based on query string or cookies.

:::note
To enable all advanced cache key functionalities, you must activate the [Application Acceleration](link_app_accel) module.
:::

To determine content variation in cache:

7. In **Cache by Query String**, Select **Content varies by some Query String fields (Whitelist)**.
8. In **Query String fields**, add the value `city`.

Now, when a request is made to an application URL `xxxxxxxxxx.map.azionedge.net/page?city=12345`, the cache key for this URL will be different from cache keys made to `xxxxxxxxxx.map.azionedge.net/page` and any other queries appended to the URL.

:::tip
Use the **Content varies by Query String, except for some fields (Blacklist)** option to do the reverse: keep all requests with query strings as different cache keys; the ones specified in **Query String fields** will be grouped into a single cache key.
:::

To disregard the order of the data sent in the query string and keep objects with the same query string values as a single cache key:

9. Enable the **Query String sort** switch.

You can also customize which types of requests can be cached:

10. Activate the **Enable caching for POST** switch to cache `POST` requests.
11. Activate the **Enable caching for OPTIONS** switch to cache `OPTIONS` requests.

Next, you can determine content variation based on cookies:

12. In **Cache by Cookies**, Select **Content varies by some Cookies (Whitelist)**.
13. In **Cookie names**, add the value `cookie_name`.

Now, when a request is made to an application and the response from the origin sends a `Set-Cookie` header, the objects in the `Cookie` request header that contain the name `cookie_name`, regardless of value, will be considered as a different object in cache from other requests.

:::tip
Use the **Content varies by Cookies, with the exception of a few (Blacklist)** option to do the reverse: keep all requests with cookies as different cache key; the ones specified in the **Cookie name** will be grouped into a single cache key.
:::

Finally, if you've created a [device group](link_dev_guide), you can segment cache keys based on the device groups you created. To do so:

14. Select **Content varies by some Device Groups (Whitelist)**.
15. Click the **+** button to add a device group.
16. Select the device group from the list.
17. Repeat steps 15 and 16 for every device group you wish to specify a different cache key.

Once you've finished configuring your cache setting:

18. Click the **Save** button.

The cache settings page now lists the newly created instance. However, this new cache setting is not active in your application. You need to define what will trigger the cache policies to be implemented in your application. For this, you can use your edge application's **Rules Engine**.

The instructions below will help you create a rule in which any request from your users to the `xxxxxxxxxx.map.azionedge.net/cache` URI will apply the cache setting you created.

1. Navigate to the **Rules Engine** tab.
2. Click the **Add Rule** button and select **Request Phase**.
3. Under the **Criteria** section, select the variable `${uri}`.

:::note
The `${uri}` variable may already be selected by default if you didn't activate **Application Acceleration**. For more information on Edge Application modules, see [some link idk](link_modules).
:::

4. As a comparison operator, select **is equal**.
5. As an argument, add `/cache`.
6. In the **Behaviors** section, select **Set Cache Policy** from the behavior list.
7. Select the new cache setting you created.
8. Click the **Save** button.
9. Wait a few minutes for the changes to propagate.

To verify how your content is being cached, follow the guide [How to verify application cache indicators using Modheader for Google Chrome](/en/documentation/products/guides/check-page-cache-time/).

## Via API

Before you run the Azion API, you'll need to [generate a personal token](link_personal_token) for your account. You also need to [retrieve your edge application ID](link_configure_edge_app) to run the following requests.

With your token and edge application ID in hand, follow the steps to create a new cache setting via API:

1. Run the following `PATCH` request in your terminal, replacing `[TOKEN VALUE]` with your personal token and the `<edge_application_id>` variable with the `id` of your edge application to activate the [Application Acceleration](link_app_accel) module:

```bash
curl --location --request PATCH 'https://api.azionapi.net/edge_applications/<edge_application_id>' \
--header 'Accept: application/json; version=3' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token [TOKEN VALUE]' \
--data '{
    "application_acceleration": true
}'
```

2. You'll receive a response with the updated value.
3. If you want to configure adaptive delivery for one of your [device groups](link_device_group), run the following `GET` request beforehand:

```bash
curl --location 'https://api.azionapi.net/edge_applications/<edge_application_id>/device_groups' \
--header 'Accept: application/json; version=3' \
--header 'Authorization: Token [TOKEN VALUE]' \
```

4. Copy the ID received in the response.

:::note
This guide describes the process of creating and activating a new cache setting in your application for a specific scenario. However, if you want to modify cache settings for your entire application, you can choose to modify your default cache setting using a `PUT` or `PATCH` request to the cache settings endpoint instead of creating a new one. In this case, you won't need to create or activate a new cache setting instance using **Rules Engine**, since the *default rule* already activates your setting.

To get your default cache settings ID and modify cache policies for your entire application, run the following `GET` request:

```bash
curl --location --request PATCH 'https://api.azionapi.net/edge_applications/<edge_application_id>/cache_settings' \
--header 'Accept: application/json; version=3' \
--header 'Authorization: Token [TOKEN VALUE]' \
```

Then, run a `PATCH` request to modify the settings using the following endpoint:

```bash
curl --location 'https://api.azionapi.net/edge_applications/<edge_application_id>/cache_settings/<cache_settings_id>' \
--header 'Accept: application/json; version=3' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token [TOKEN VALUE]' \
--data '{
    <Insert data as described below>
}'
```
:::

5. Run the following `POST` request in your terminal, replacing `[TOKEN VALUE]` with your personal token, the `<edge_application_id>` variable with the `id` of your edge application, and the `<device_group_id>` with the ID of the device group, if desired:

```bash
curl --location 'https://api.azionapi.net/edge_applications/<edge_application_id>/cache_settings' \
--header 'Accept: application/json; version=3' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token [TOKEN VALUE]' \
--data '{
    "name": "Settings - /cache",
    "browser_cache_settings": "override",
    "browser_cache_settings_maximum_ttl": 60,
    "cdn_cache_settings": "override",
    "cdn_cache_settings_maximum_ttl": 13660,
    "cache_by_query_string": "whitelist",
    "query_string_fields": [
        "city"
    ],
    "adaptive_delivery_action": "whitelist",
    "device_group": [
        <device_group_id>
    ],
    "enable_query_string_sort": false,
    "enable_caching_for_options": true,
    "cache_by_cookies": "whitelist",
    "cookie_names": [
      "cookie_name"
    ],
    "enable_caching_for_post": true,
    "l2_caching_enabled": false,
    "is_slice_configuration_enabled": true,
    "is_slice_edge_caching_enabled": true,
    "is_slice_l2_caching_enabled": false
}'
```

  | Key | Description |
  | --- | --- |
  | `name` | Sets the string in value as a name of the cache setting. |
  | `browser_cache_settings` | Sets the string in value as the policy selected for browsers in relation to the TTL values sent in the `Cache-Control` or `Expires` headers. When `"honor"`, cache TTL directives received from the origin are implemented. When `"override"`, allows you to determine the browser cache TTL through `browser_cache_settings_maximum_ttl`. |
  | `browser_cache_settings_maximum_ttl` | Determines the TTL for browser cache in seconds. |
  | `cdn_cache_settings` | Sets the string in value as the policy selected for the edge in relation to the TTL values sent in the `Cache-Control` or `Expires` headers. When `"honor"`, cache TTL directives received from the origin are implemented. When `"override"`, allows you to determine the edge cache TTL through `cdn_cache_settings_maximum_ttl`. |
  | `cdn_cache_settings_maximum_ttl` | Determines the TTL for edge cache in seconds. If no headers are received from the origin, implements a default TTL value. |
  | `cache_by_query_string` | Defines whether cache should be segmented into cache keys based on query strings. For all available options, see the [API documentation](link_api). |
  | `query_string_fields` | Sets the strings listed as the keys of queries that should be maintained as the same cache key or segmented into separate cache keys. |
  | `adaptive_delivery_action` | Defines whether cache should be segmented into cache keys based on [device groups](link_dev_grp). |
  | `device_group` | Sets the IDs listed as the device groups that should be maintained as the same cache key or segmented into separate cache keys. |
  | `enable_query_string_sort` | If `true`, a single cache key is generated for URLs with the same query strings regardless of the order in which they are grouped. |
  | `enable_caching_for_options` | If `true`, `OPTIONS` requests can be cached. |
  | `cache_by_cookies` | Defines whether cache should be segmented into cache keys based on cookies. For all available options, see the [API documentation](link_api). |
  | `cookie_names` | Sets the strings listed as the names of cookies that should be maintained as the same cache key or segmented into separate cache keys. |
  | `enable_caching_for_post` | If `true`, `POST` requests can be cached. |
  | `l2_caching_enabled` | If `true`, enables caching in the L2. You must have the [L2 Caching](l2_caching) module active to enable this setting. |
  | `is_slice_configuration_enabled` | If `true`, enables the file slicing feature. |
  | `is_slice_edge_caching_enabled` | If `true`, enables file slicing for the edge. If `is_slice_configuration_enabled` is set to true, this property must also be set to `true`. |
  | `is_slice_l2_caching_enabled` | If `true`, enables file slicing for the L2. You must have the [L2 Caching](l2_caching) module active to enable this setting. |

6. You'll receive a response similar to this:

```json
{
    "results": {
        "id": <cache_settings_id>,
        "name": "Settings - /cache",
        "browser_cache_settings": "override",
        "browser_cache_settings_maximum_ttl": 60,
        "cdn_cache_settings": "override",
        "cdn_cache_settings_maximum_ttl": 13660,
        "cache_by_query_string": "whitelist",
        "query_string_fields": [
            "city"
        ],
        "enable_query_string_sort": true,
        "cache_by_cookies": "whitelist",
        "cookie_names": [
          "cookie_name"
        ],
        "adaptive_delivery_action": "whitelist",
        "device_group": [
            <device_group_id>
        ],
        "enable_caching_for_post": true,
        "l2_caching_enabled": false,
        "is_slice_configuration_enabled": true,
        "is_slice_edge_caching_enabled": true,
        "is_slice_l2_caching_enabled": false,
        "slice_configuration_range": 1024,
        "enable_caching_for_options": true,
        "enable_stale_cache": true,
        "l2_region": null
    }
}
```

Now to activate the cache setting for your application:

7. Run the following `POST` request in your terminal, replacing `[TOKEN VALUE]` with your personal token, the `<edge_application_id>` variable with the `id` of your edge application, and the `<cache_setting_id>` variable with the cache setting ID received in the response:

```bash
curl --location 'https://api.azionapi.net/edge_applications/<edge_application_id>/rules_engine/request/rules' \
--header 'Accept: application/json; version=3' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token [TOKEN VALUE]' \
--data '{
    "name": "Set cache setting - /cache",
    "behaviors": [
        {
            "name": "set_cache_policy",
            "target": "<cache_setting_id>"
        }
    ],
    "criteria": [
        [
            {
                "variable": "${uri}",
                "operator": "is_equal",
                "conditional": "if",
                "input_value": "/cache"
            }
        ]
    ]
}'
```

8. Wait a few minutes for the changes to propagate.

To verify how your content is being cached, follow the guide [How to verify application cache indicators using Modheader for Google Chrome](/en/documentation/products/guides/check-page-cache-time/).
