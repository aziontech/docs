---
title: Process Images
description: insert later
meta_tags: build
namespace: docs_guides_build_advanced_process_images
permalink: /documentation/products/guides/build/process-images/
---

Through the **Image Processor** module, you can adjust image sizes, add filters and watermarks, or convert formats to suit for more efficient content delivery, bandwidth saving, and reduce object storage costs. These changes can be applied directly in the URL of your image by appending the queries described in the [Image Processor](/en/documentation/products/edge-application/image-processor/) page to the image's URL, which you may do using an [edge function](/en/documentation/products/edge-application/edge-function/).

In addition, **Image Processor** detects the browser's compatibility with WEBP format and, when possible, it'll convert the image format automatically. BMP images will also be automatically converted to JPEG or WEBP, depending on the browser's compatibility.

<Button href="/en/documentation/products/edge-application/image-processor/" text="Go to Image Processor documentation"></Button>

:::caution[warning]
If you wish to optimize your images, the [Image Processor](link_img_process) module is required, and the [Application Acceleration](link_app_accel) module is recommended for cache efficiency. If these modules are activated, images processed and data transfer could generate usage-related costs. Check the [pricing page](https://www.azion.com/en/pricing/) for more information.
:::

To activate this module and start processing your images, you'll need:

- An [Azion account](link_accounts).
- An [edge application](link_build_with_edge_app).
- An [Azion domain](link_config_domain).

You can activate the [Real-Time Manager (RTM)](#via-rtm) or the [Azion API](#via-api).

## Via RTM

1. [Access RTM](link_rtm).
2. On the upper-left corner of the page, open the **Products menu**, represented by three horizontal lines, and select **Edge Application**.
3. Click the edge application you want to configure. 
4. Activate the **Application Acceleration** and **Image Processor** modules.
5. Navigate to the **Cache Settings** tab.
6. Click the **Add Cache Settings** button.
7. In the **Expiration Settings** section, configure the [expiration policy](/en/documentation/products/edge-application/cache-settings/#browser-cache-settings) for your images. For images, you may add larger time-to-live (TTL) values, such as `1296000` seconds (15 days).
8. In the **Advanced Cache Key** section, choose one of the following options:

    - **Content varies by some Query String fields (Whitelist)**: if you want to list all the fields in the Query String that will identify your images. **Image Processor** uses the *ims* field, so this has to be included in the list as one of the required fields for your image manager application.
    - **Content varies by Query String, except for some fields (Blacklist)**: if you only want to list those fields in the Query String that should be ignored to identify the objects in your cache. In this case, it guarantees that the *ims* field will be removed from the list.
    - **Content varies by all Query String fields**: if you don't know or aren't sure about which fields to list in the Query String because you aren't responsible for all the content in the cache or don't have [Application Acceleration](/en/documentation/products/edge-application/application-acceleration/) activated.

9. Click the **Save** button.

Now you need to indicate what will trigger the activation of the **Image Processor** module. You can create a rule that identifies image formats as follows:

1. Navigate to the **Rules Engine** tab
2. Click the **Add Rule** button and select **Request Phase**.
3. Name your rule.
4. In the **Criteria** section, select the variable `${request_uri}`.
5. Select the comparsion operator **matches**
6. As an argument, add `\.(jpg|jpeg|gif|bmp|png)`.
7. Click **Or** to add another criterium.
8. In the new field, select the variable `${uri}`.
9. Select the comparsion operator **matches**
10. As an argument, add `\.(jpg|jpeg|gif|bmp|png)$`
11. In the **Behavior** section, select **Set Cache Policy** and select the cache setting you created.
12. Click the **+** button.
13. Add the **Optimize Images** behavior.
:::note[Optional]
To ensure images are successfully converted to WEBP format, you must also add the behavior **Add Request Header** and send the header `Accept: image/webp`.
:::
12. Click the **Save** button to save your rule.

From this point on, images from the configured path will be automatically processed. 

To confirm whether your image is being optimized, [inspect the page](https://developer.mozilla.org/en-US/docs/Learn/Common_questions/What_are_browser_developer_tools) using your browser and find the corresponding path in the image. In the URL's query string, the `ims=VALUExVALUE` field corresponds to the resolution loaded on the page. To see the original file, you only need to remove the query string added in the URL.

## Via API

This section contains a sequence of Client URL (cURL) commands you can run in a command terminal or in an API platform of your choosing. 

Before you run the Azion API, you'll need to [generate a personal token](link_personal_token) for your account. You also need to [retrieve your edge application ID](link_configure_edge_app) to run the following requests.

With your token and edge application ID in hand, follow the steps to activate image processor via API:

1. Run the following `PATCH` request in your terminal, replacing `[TOKEN VALUE]` with your personal token and the `<edge_application_id>` variable with the `id` of your edge application to activate the [Application Acceleration](link_app_accel) and [Image Processor](link_img_process) modules:

```bash
curl --location --request PATCH 'https://api.azionapi.net/edge_applications/<edge_application_id>' \
--header 'Accept: application/json; version=3' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token [TOKEN VALUE]' \
--data '{
    "application_acceleration": true,
    "image_optimization": true
}'
```

2. You'll receive a response with the updated value.
3. Run the following `POST` request in your terminal, replacing `[TOKEN VALUE]` with your personal token and the `<edge_application_id>` variable with the `id` of your edge application:

```bash
curl --location 'https://api.azionapi.net/edge_applications/<edge_application_id>/cache_settings' \
--header 'Accept: application/json; version=3' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token [TOKEN VALUE]' \
--data '{
    "name": "QS15D img",
    "browser_cache_settings": "override",
    "browser_cache_settings_maximum_ttl": 60,
    "cdn_cache_settings": "override",
    "cdn_cache_settings_maximum_ttl": 1296000,
    "cache_by_query_string": "whitelist",
    "query_string_fields": [
        "ims"
    ]
}'
```

:::note
For more information on the cache settings endpoint, see [Tune your cache settings](link_tune).
:::

4. You'll receive a response similar to this:

```json
{
    "results": {
        "id": <cache_setting_id>,
        "name": "QS15D img",
        "browser_cache_settings": "override",
        "browser_cache_settings_maximum_ttl": 60,
        "cdn_cache_settings": "override",
        "cdn_cache_settings_maximum_ttl": 1296000,
        "cache_by_query_string": "whitelist",
        "query_string_fields": [
            "ims"
        ],
        "enable_query_string_sort": false,
        "cache_by_cookies": "ignore",
        "cookie_names": null,
        "adaptive_delivery_action": "ignore",
        "device_group": [],
        "enable_caching_for_post": false,
        "l2_caching_enabled": false,
        "is_slice_configuration_enabled": false,
        "is_slice_edge_caching_enabled": false,
        "is_slice_l2_caching_enabled": false,
        "slice_configuration_range": 1024,
        "enable_caching_for_options": false,
        "enable_stale_cache": true,
        "l2_region": null
    }
}
```

5. Copy the cache setting ID received in the response.
6. Run the following `POST` request to create a rule in the **Request Phase**, replacing the edge application ID value and the cache setting ID you received in the previous response:

```bash
curl --location --globoff 'https://api.azionapi.net/edge_applications/<edge_application_id>/rules_engine/request/rules' \
--header 'Accept: application/json; version=3' \
--header 'Authorization: Token [TOKEN VALUE]' \
--header 'Content-Type: application/json' \
--data '{
    "name": "ImgProcessor",
    "behaviors": [
        {
            "name": "set_cache_policy",
            "target": "<cache_settings_id>"
        },
        {
            "name": "optimize_images",
            "target": null
        }
    ],
    "criteria": [
        [
            {
                "variable": "${request_uri}",
                "operator": "matches",
                "conditional": "if",
                "input_value": "\\.(jpg|jpeg|gif|bmp|png)"
            },
            {
                "variable": "${uri}",
                "operator": "matches",
                "conditional": "or",
                "input_value": "\\.(jpg|jpeg|gif|bmp|png)$"
            }
        ]
    ]
}'
```

:::note
For more information on the rules endpoint, see [Work with Rules Engine](link_work_rules).
:::

7. You'll receive the following response:

```json
{
    "results": {
        "id": <rule_id>,
        "name": "ImgProcessor",
        "phase": "request",
        "behaviors": [
            {
                "name": "set_cache_policy",
                "target": "132186"
            },
            {
                "name": "optimize_images",
                "target": null
            }
        ],
        "criteria": [
            [
                {
                    "variable": "${request_uri}",
                    "operator": "matches",
                    "conditional": "if",
                    "input_value": "\\.(jpg|jpeg|gif|bmp|png)"
                },
                {
                    "variable": "${uri}",
                    "operator": "matches",
                    "conditional": "or",
                    "input_value": "\\.(jpg|jpeg|gif|bmp|png)$"
                }
            ]
        ],
        "is_active": true,
        "order": 3,
        "description": null
    }
}
```

:::tip
Check the [Azion API documentation](link_azionapi) and the [OpenAPI specification](link_openapi) to know more about what the Azion API can offer.
:::

From this point on, images from the configured path will be automatically processed. 

To confirm whether your image is being optimized, [inspect the page](https://developer.mozilla.org/en-US/docs/Learn/Common_questions/What_are_browser_developer_tools) using your browser and find the corresponding path in the image. In the URL's query string, the `ims=VALUExVALUE` field corresponds to the resolution loaded on the page. To see the original file, you only need to remove the query string added in the URL.
