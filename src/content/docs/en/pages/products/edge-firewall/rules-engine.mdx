---
title: Rules Engine for Edge Firewall
description: The Rules Engine is designed for you to be able to implement your security logic at the edge. Based on programmable criteria, you choose what you want to do.
meta_tags: edge computing, rules engine
namespace: documentation_products_edge_firewall_rules_engine
permalink: /documentation/products/edge-firewall/rules-engine/
---

The **Rules Engine** is designed for you to be able to implement your security logic at the edge. Based on programmable criteria, you choose what you want to do.

Here are some of the ways **Rules Engine** can help you: 

* Block a request.
* Ignore a request.
* Limit the access rate.
* Apply Web Application Firewall (WAF) policy.
* Run an **Edge Function** with your own security code.
* Monitor traffic to identify threats.

---

## How it works

Each request from your users to your application is processed first by **Edge Firewall**.

You can define a set of security rules in **Edge Firewall**. The rules are composed by *Criteria*, which represent the conditions for executing the rules, and by *Behaviors*, which represent the actions that need to be executed.

The processing of the rules is sequential and you can use them as *Criteria* as a powerful set of variables and comparison operators. If the conditions are met, the *Behaviors* of each rule are executed until all the rules are processed or a rule with a finalizing behavior is found in the path - *Deny* or *Drop*.

---

## Rules

Rules are always composed of *Criteria* (conditions) and *Behaviors* (actions). You can also add a *description* to your rule sets.

### Description

Aside from the name of the rule, you can add a description to your rule using the **Description** field. Your description will be visible from the rule set list and can be used to help you identify what the rule does.

### Criteria

It determines the set of conditions that need to be met for the execution of *Behaviors*.

#### Variables

| Criteria               | Description                                                  | Requirements             |
| ---------------------- | ------------------------------------------------------------ | ------------------------ |
| Header Accept          | Header that tells you what types of media the customer accepts for the response. | Web Application Firewall |
| Header Accept-Encoding | Header that tells you what types of content encoding, usually compression algorithms that the client accepts for the response. | Web Application Firewall |
| Header Accept-Language | Header that informs the expected language.                   | Web Application Firewall |
| Header Cookie          | Header containing the cookies sent by the client in the request to the server. | Web Application Firewall |
| Header Origin          | Header that informs the origin of a cross-site access request or a preflight request. The source is a URI indicating the name of the server, with no path information. | Web Application Firewall |
| Header Referer         | Header indicating the address of the document, or element in a document, from which the request's URI was obtained. | Web Application Firewall |
| Header User Agent      | Header with a characteristic string that allows servers to identify the application, operating system, vendor and/or version of the device. | Web Application Firewall |
| Hostname               | In order of precedence: the *hostname* of the request line, or the value of the *Host* header field of the request, or the name of the server serving the request. | -                        |
| Network                | The IP address of the client making the HTTP request, which can be used for any network comparison (CIDR, ASN or Country). | Network Layer Protection |
| Request Args           | All arguments sent by the user in the request string (*query string*). | Web Application Firewall |
| Request Method         | The request's HTTP method. For example: GET, POST, PUT, etc. | -                        |
| Request URI            | This relates to the `${uri}` variable from Rules Engine for Edge Applications. The normalized (urldecoded) URI of the request. The value of `${uri}` can change during the processing of a request, for example, when an internal redirect occurs or when index files are used. It does NOT carry the Query String parameters as `${request_uri}` do.| -                        |
| Scheme                 | The scheme of the request: http or https.                    | -                        |
| Client Certificate Validation | Server process to authenticate client digital certificate. | - |  


#### Comparison Operators

The condition for the execution of a rule must be the comparison of a variable with an argument. The comparison operators are:

| Operador            | Description                                                  | Argument                   |
| ------------------- | ------------------------------------------------------------ | -------------------------- |
| is equal            | The value of the variable is equal to the argument, compared character by character. | string                     |
| is not equal        | The value of the variable is not exactly the same as the argument. | string                     |
| starts with         | The value of the variable starts with the argument.          | string                     |
| does not start with | The value of the variable does not start with the argument.  | string                     |
| matches             | The value of the variable matches the regular expression or list entered as an argument. | regular expression<br />list |
| does not match      | The value of the variable does not match the regular expression entered as an argument. | regular expression<br />list |
| exists              | The variable has a defined value. For example, Request Args exists if an argument is sent in the request's query string. | -                          |
| does not exist      | The variable does not have a defined value. For example, Request Args does not exist if an argument is sent in the request's query string. | -                          |

> Note: The options vary according to the selected *Criteria*.

#### Logic Operators

Multiple conditions can be defined using the logical operators "*and*" and "*or*”. The operator “and” has implicit precedence over the operator “*or*”.

If explicit precedence is required, you can add multiple criteria groups under the "*and*" logic.

### Behaviors

In *Behavior*, you add the behaviors (actions) you want to perform if the rule's conditions (Criteria) are met.

| Behavior                      | Description                                                  | Requirements             |
| ----------------------------- | ------------------------------------------------------------ | ------------------------ |
| Deny (403 Forbidden)          | It closes the request with HTTP *403 Forbidden* response.    | -                        |
| Drop (Close Without Response) | It closes the request without responding to the customer.    | -                        |
| Set Rate Limit                | It defines an access rate limit that, if exceeded, will result in an HTTP *429 Too Many Requests* response. To configure the *Rate Limit*, you must inform:<br />**Type** is the field to select the type of request for the Rate Limit, choosing **Req/s** (Requests per Second) or **Req/Min** (Requests per Minute); <br />**Average Rate Limit**, which is the limit rate itself by second; <br />**Client IP address**, if you want the access rate to be counted by the client's IP address or **Global**, if you want total access rate counted; <br />**Maximum burst size***, which indicates the maximum burst size of HTTP requests sent simultaneously, which will be queued and dispatched gradually, respecting the limit rate. <br /><br />`* The Maixumum Burst size is only available for the "Req/s"(Request per Second).`<br />The configured value will be the Rate Limit for each Azion Edge Node, implemented using the Leaky Bucket algorithm. We recommend that you use *Maximum burst size* at a maximum of 10 times of the value configured in *Average Rate Limit*, which would result in penalizing the last request for a burst with up to a 10 second delay. | -                        |
| Set WAF Rule Set              | It associates the WAF Rule Set to be used in the request. WAF policies must be previously configured in the *Edge Libraries > WAF Rules*. | Web Application Firewall |
| Run Function                  | It runs a function specified as a parameter. The function must have been previously instantiated and parameterized in the Functions tab, in order to be used. | Edge Functions           |