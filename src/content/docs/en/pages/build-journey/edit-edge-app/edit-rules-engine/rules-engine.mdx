---
title: How to create rules to automate behaviors with Rules Engine
description: >-
  Integrate rules in your application to set tasks for specific scenarios
  without changing your existing code.
meta_tags: build
namespace: docs_guides_build_work_with_rules_engine
permalink: /documentation/products/guides/build/work-with-rules-engine/
---

import Tabs from '~/components/tabs/Tabs'
import Code from '~/components/Code/Code.astro'
import Apiv4Rollout from '~/includes/snippets/apiv4Rollout/en/snippet.mdx'

<Apiv4Rollout />

Implementing rules in your application using [Rules Engine](/en/documentation/products/build/edge-application/rules-engine/) will allow you to determine the tasks it should execute in specific scenarios without modifying your application's code.

This guide demonstrates the process of creating rules with a practical example, but most rules will be unique to each application and its needs. In addition to activating variables such as [device groups](/en/documentation/products/guides/build/create-device-groups/), [cache settings](/en/documentation/products/build/edge-application/cache-settings/), and [origins](/en/documentation/products/guides/build/work-with-origins/), you can create a wide variety of rules in both the request and response phases.

With this guide, you'll create a rule in the response phase to remove an HTTP header using the **Filter Response Header** behavior.

:::tip
If you're not sure which steps apply to your account, see [this guide](/en/documentation/products/guides/verify-account-migration/) to determine if your account has already been migrated.
:::

:::caution[warning]
To unlock the full capabilities of Rules Engine, you should activate the [Application Accelerator](/en/documentation/products/build/edge-application/application-accelerator/) module. If **Application Accelerator** is activated, data transfer could generate usage-related costs. Check the [pricing page](/en/documentation/products/pricing/) for more information.
:::

---

<Tabs client:visible>
    <Fragment slot="tab.consoleworkloads">Console - Workloads</Fragment>
    <Fragment slot="tab.consoledomain">Console - Domains</Fragment>
    <Fragment slot="tab.apiv4">API v4</Fragment>
    <Fragment slot="tab.apiv3">API v3</Fragment>

<Fragment slot="panel.consoleworkloads">

To configure rules via Workloads:

1. Access [Azion Console](/en/documentation/products/guides/how-to-access-azion-console/) > **Workloads**.
2. Select your workload.
3. Navigate to **Deployment Settings**.
4. In **Rules Engine**, click **+ Rule**.
5. Configure your rule name, phase (Request/Response), criteria, and behaviors.
6. Click **Save**.

:::note
With Workloads, rules are configured as part of the deployment settings and are automatically applied to handle request and response processing for your workload.
:::

</Fragment>

<Fragment slot="panel.consoledomain">

To configure rules via traditional Domains interface:

To activate the **Application Accelerator** module:

1. Access [Azion Console](/en/documentation/products/guides/how-to-access-azion-console/) > **Edge Application**.
2. Click the edge application you want to configure. 
3. Activate the **Application Accelerator** module.
4. Click the **Save** button.

The `Server` header stores information about the server that generated the response. By removing this header, end-users won't receive information about the infrastructure of your application, enhancing your security by reducing the information available to potential attackers.

:::note
Exercise caution when removing any headers from your edge application and ensure that this action doesn't interfere in any applicable standards and guidelines.
:::

To remove the `Server` header:

1. Navigate to the **Rules Engine** tab.
2. Click the **+ Rule** button.
3. Give your rule a name and, if necessary, a description. 
4. Select **Response Phase**.
5. In the **Criteria** section, select the `${uri}` variable.
6. As a comparison operator, select **starts with**.
7. As an argument, add the value `/`.
8. In the Behaviors section, select **Filter Response Header**.
9. As an argument, add `Server`.
10. Click the **Save** button.

</Fragment>

<Fragment slot="panel.apiv4">

To configure rules via API v4:

1. First, activate the Application Accelerator module:

<Code lang="bash" code={`curl --request PATCH \\
  --url https://api.azion.com/v4/edge_applications/<edge_application_id> \\
  --header 'Accept: application/json' \\
  --header 'Content-Type: application/json' \\
  --header 'Authorization: Token [TOKEN VALUE]' \\
  --data '{
    "application_acceleration": true
  }'`} />

2. Create a rule in the response phase to filter the Server header:

<Code lang="bash" code={`curl --request POST \\
  --url https://api.azion.com/v4/edge_applications/<edge_application_id>/rules_engine/response/rules \\
  --header 'Accept: application/json' \\
  --header 'Content-Type: application/json' \\
  --header 'Authorization: Token [TOKEN VALUE]' \\
  --data '{
    "name": "FilterRespHeader Server",
    "behaviors": [
      {
        "name": "filter_response_header",
        "target": "Server"
      }
    ],
    "criteria": [
      [
        {
          "variable": "${uri}",
          "operator": "starts_with",
          "conditional": "if",
          "argument": "/"
        }
      ]
    ]
  }'`} />

:::tip
Check the [Rules Engine API v4 documentation](https://api.azion.com/v4#/operations/GetApplicationsRulesEngineResponseRules) for more details.
:::

</Fragment>

<Fragment slot="panel.apiv3">

To configure rules via API v3:

1. Run the following `PATCH` request in your terminal, replacing `[TOKEN VALUE]` with your [personal token](/en/documentation/products/guides/personal-tokens/) and the `<edge_application_id>` variable with [your edge application ID](/en/documentation/products/guides/build/configure-main-settings/) to activate the [Application Accelerator](/en/documentation/products/build/edge-application/application-accelerator/) module:

<Code lang="bash" code={`curl --location --request PATCH 'https://api.azionapi.net/edge_applications/<edge_application_id>' \\
  --header 'Accept: application/json; version=3' \\
  --header 'Content-Type: application/json' \\
  --header 'Authorization: Token [TOKEN VALUE]' \\
  --data '{
    "application_acceleration": true
  }'`} />

2. You'll receive a response with the updated value.
3. Run the following `POST` request to create a rule in the response phase, replacing `<edge_application_id>` with the `id` value you received in the previous response:

<Code lang="bash" code={`curl --location 'https://api.azionapi.net/edge_applications/<edge_application_id>/rules_engine/response/rules' \\
  --header 'Accept: application/json; version=3' \\
  --header 'Authorization: Token [TOKEN VALUE]' \\
  --header 'Content-Type: application/json' \\
  --data '{
    "name": "FilterRespHeader Server",
    "behaviors": [
      {
        "name": "filter_response_header",
        "target": "Server"
      }
    ],
    "criteria": [
      [
        {
          "variable": "${uri}",
          "operator": "is_equal",
          "conditional": "if",
          "input_value": "/"
        }
      ]
    ]
  }'`} />

4. You'll receive the following response:

```json
{
  "results": {
    "id": <rule_id>,
    "name": "FilterRespHeader Server",
    "phase": "response",
    "behaviors": [
      {
        "name": "filter_response_header",
        "target": "Server"
      }
    ],
    "criteria": [
      [
        {
          "variable": "${uri}",
          "operator": "is_equal",
          "conditional": "if",
          "input_value": "/"
        }
      ]
    ],
    "is_active": true,
    "order": 1,
    "description": null
  }
}
```

5. Wait a few minutes for the changes to propagate.

:::tip
Check the [Rules Engine API v3 documentation](https://api.azionapi.net/api/v3#/Rules%20Engine) for more details.
:::

</Fragment>

</Tabs>