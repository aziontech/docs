---
title: How to configure multiple origins with load balancing algorithms
description: >-
  Explore how to configure Load Balancer for Edge Applications on Azion,
  ensuring optimal traffic distribution and server efficiency with the Round
  Robin algorithm.
permalink: /documentation/products/guides/build/multiple-origins/
meta_tags: >-
  Load Balancer, Edge Application, Round Robin algorithm, server capacity
  management, traffic management, Azion products, cloud service integration,
  high availability servers, application scalability, origin configuration
namespace: docs_guides_build_advanced_multi_origins
---

import Tabs from '~/components/tabs/Tabs'
import Code from '~/components/Code/Code.astro'
import Apiv4Rollout from '~/includes/snippets/apiv4Rollout/en/snippet.mdx'

<Apiv4Rollout />

When you [create an edge application](/en/documentation/products/start-with-a-template/), you need to define an origin. However, more complex and robust infrastructures may need multiple origins for the same application. The [Load Balancer](/en/documentation/products/build/edge-application/load-balancer/) module allows you to use load balancing algorithms to manage high access numbers and control the behaviors of your origin.

:::tip
If you're not sure which steps apply to your account, see [this guide](/en/documentation/products/guides/verify-account-migration/) to determine if your account has already been migrated.
:::

:::caution[warning]
If **Load Balancer** is activated, data transfer could generate usage-related costs. Check the [pricing page](/en/documentation/products/pricing/) for more information.
:::

The following steps will walk you through a hypothetical scenario where the default origin should be of the Load Balancer-type with the [Round Robin algorithm](/en/documentation/products/build/edge-application/load-balancer/#balancing-method). Feel free to interpret and modify the step-by-step instructions according to your specific use case.

The following business rules of different origin servers must be configured with load balancing:

- The application should have three origins.
  - The primary server should have a higher load capacity.
  - The secondary server should have a medium load capacity, enough to handle large surges of incoming traffic.
  - The backup server should have a low load capacity and only be active in special circumstances.
- Each of these servers should be hosted in a different storage provider or cloud service since server outages don't often occur simultaneously.
- All origins must contain the same content and be set up in the exact same way for the edge application.

Therefore, the setup would be:

| Origin | Role | Address | Load capacity | Status |
| --- | --- | --- | --- | --- |
| 1 | Primary server | `example.com` | High load capacity | Should always be active. |
| 2 | Secondary server | `example.net` | Medium load capacity | Should always be active. |
| 3 | Backup server | `example.org` | Low load capacity | Should only be active in case of maintenance or traffic surges. |

---

<Tabs client:visible>
<Fragment slot="tab.consoleworkloads">Console - Workloads</Fragment>
<Fragment slot="tab.consoledomain">Console - Domains</Fragment>
<Fragment slot="tab.apiv4">API v4</Fragment>
<Fragment slot="tab.apiv3">API v3</Fragment>

<Fragment slot="panel.consoleworkloads">

To configure load balancing via Workloads (using Edge Connectors):

1. Access [Azion Console](/en/documentation/products/guides/how-to-access-azion-console/) > **Edge Connectors**.

2. Create multiple Edge Connectors for your origins:

**For the primary server:**
- Click **+ Edge Connector**
- Name: `primary-server-connector`
- Type: **HTTP**
- Protocol: **HTTPS**
- Address: `example.com`
- Weight: `3` (higher capacity)
- Click **Save**

**For the secondary server:**
- Click **+ Edge Connector**
- Name: `secondary-server-connector` 
- Type: **HTTP**
- Protocol: **HTTPS**
- Address: `example.net`
- Weight: `2` (medium capacity)
- Click **Save**

**For the backup server:**
- Click **+ Edge Connector**
- Name: `backup-server-connector`
- Type: **HTTP** 
- Protocol: **HTTPS**
- Address: `example.org`
- Weight: `1` (low capacity)
- Status: **Inactive** (backup only)
- Click **Save**

3. Configure load balancing in your Workload:
- Go to **Workloads**
- Select your workload
- Navigate to **Deployment Settings**
- In **Edge Connectors**, add all three connectors
- Configure **Load Balancing Method** to **Round Robin**
- Set the weight distribution according to server capacity
- Click **Save**

:::note
With Workloads, Edge Connectors provide more granular control over load balancing and can be reused across different workloads.
:::

</Fragment>

<Fragment slot="panel.consoledomain">
To configure load balancing via traditional Domains interface:

First, to enable the **Load Balancer** module:

1. Access [Azion Console](/en/documentation/products/guides/how-to-access-azion-console/) > **Edge Application**.
2. Click the edge application for which you want to configure a new origin with load balancer.
3. On the **Main Settings** tab, under **Modules**, activate **Load Balancer**.
4. Click the **Save** button.

:::caution[warning]
In this section, you'll modify your default origin, which is of the Single Origin-type, into a Load Balancer-type origin. Editing your default origin will override the origin you configured when creating the edge application. To create a different origin, see [how to work with origins](/en/documentation/products/guides/build/work-with-origins/).
:::

To customize the origin according to the scenario described above:

1. Select the **Origins** tab.
2. In the **Origins** tab, click the **Default Origin** from the list.
3. Give your new origin a name.
4. Under **Type**, select **Load Balancer**.
5. In the **Method** field, select **Round-Robin**.
6. In the first **Address** field, specify the primary server. For example, `example.com`.
7. Since this origin has a higher load capacity, in the **Weight** field, add a weight of `3` to this first origin.
8. In the **Server Role** field, keep **Primary** selected.
9. Keep this origin **Active**.
10. In the second **Address** field, specify the secondary server. In this case, `example.net`.
11. Due to its lower capacity, in the **Weight** field, add a weight of `2` to this origin.
12. In the **Server Role** field, select **Primary**. This origin has a lower weight value, the preferred origin for connections will be the first.
13. Keep this origin **Active**.
14. Add a third origin by clicking the **+ Add Origin** button.
15. In the **Address** field, specify the backup origin. In this case, `example.org`.
16. Keep the **Weight** field blank. It'll assume a default value of `1`.
17. In the **Server Role** field, select **Backup**.
18. Disable this origin by turning off the **Active** switch.
19. Click the **Save** button.

Wait a few minutes for the changes to propagate. Then, access your application or use the command line to make a request and check if the changes were made.
</Fragment>

<Fragment slot="panel.apiv4">

To configure load balancing via Edge Connectors API v4:

1. Create multiple Edge Connectors with different weights:

**Primary server connector:**
<Code lang="bash" code={`curl --request POST \\
  --url https://api.azion.com/v4/edge_connector/connectors \\
  --header 'Accept: application/json' \\
  --header 'Authorization: Token [TOKEN VALUE]' \\
  --header 'Content-Type: application/json' \\
  --data '{
    "name": "primary-server-connector",
    "type": "http",
    "endpoint": {
      "protocol": "https",
      "address": "example.com",
      "weight": 3
    }
  }'`} />

**Secondary server connector:**
<Code lang="bash" code={`curl --request POST \\
  --url https://api.azion.com/v4/edge_connector/connectors \\
  --header 'Accept: application/json' \\
  --header 'Authorization: Token [TOKEN VALUE]' \\
  --header 'Content-Type: application/json' \\
  --data '{
    "name": "secondary-server-connector",
    "type": "http",
    "endpoint": {
      "protocol": "https",
      "address": "example.net",
      "weight": 2
    }
  }'`} />

**Backup server connector:**
<Code lang="bash" code={`curl --request POST \\
  --url https://api.azion.com/v4/edge_connector/connectors \\
  --header 'Accept: application/json' \\
  --header 'Authorization: Token [TOKEN VALUE]' \\
  --header 'Content-Type: application/json' \\
  --data '{
    "name": "backup-server-connector",
    "type": "http",
    "endpoint": {
      "protocol": "https",
      "address": "example.org",
      "weight": 1
    },
    "active": false
  }'`} />

2. Configure workload deployment with load balancing:

<Code lang="bash" code={`curl --request POST \\
  --url https://api.azion.com/v4/workspace/workloads/<workload_id>/deployments \\
  --header 'Accept: application/json' \\
  --header 'Authorization: Token [TOKEN VALUE]' \\
  --header 'Content-Type: application/json' \\
  --data '{
    "name": "Load Balanced Deployment",
    "current": true,
    "active": true,
    "strategy": {
      "type": "load_balanced",
      "attributes": {
        "method": "round_robin",
        "edge_connectors": [
          <primary_connector_id>,
          <secondary_connector_id>,
          <backup_connector_id>
        ]
      }
    }
  }'`} />

:::tip
Check the [Edge Connectors API v4 documentation](https://api.azion.com/v4#/operations/GetEdgeConnectorConnectors) for more details.
:::

</Fragment>

<Fragment slot="panel.apiv3">
To configure load balancing via API v3:

1. Run the following `GET` request in your terminal, replacing `[TOKEN VALUE]` with your [personal token](/en/documentation/products/guides/personal-tokens/) and `<edge_application_id>` variable with [your edge application ID](/en/documentation/products/guides/build/configure-main-settings/) to retrieve your default origin's `<origin_key>`, which is a UUID value:

<Code lang="bash" code={`curl --request GET \\
  --url https://api.azionapi.net/edge_applications/<edge_application_id> \\
  --header 'Accept: application/json; version=3' \\
  --header 'Authorization: Token [TOKEN VALUE]'`} />

2. You'll receive a response similar to this:

```json
{
    "results": {
        "origin_id": <origin_id>,
        "origin_key": "<origin_key>",
        "name": "Default Origin",
        "origin_type": "single_origin",
        ...
    }
}
```

3. Copy the `<origin_key>` value.
4. Run the following `PATCH` request to modify the default origin as follows, replacing the key and application id in the URL:

<Code lang="bash" code={`curl --request PATCH \\
  --url https://api.azionapi.net/edge_applications/<edge_application_id>/origins/<origin_key> \\
  --header 'Accept: application/json; version=3' \\
  --header 'Content-Type: application/json' \\
  --header 'Authorization: Token [TOKEN VALUE]' \\
  --data '{
    "name": "Default Origin (RR3)",
    "origin_type": "load_balancer",
    "addresses": [
      {
        "address": "example.com",
        "weight": 3,
        "server_role": "primary",
        "is_active": true
      },
      {
        "address": "example.net",
        "weight": 2,
        "server_role": "primary",
        "is_active": true
      },
      {
        "address": "example.org",
        "weight": 1,
        "server_role": "backup",
        "is_active": false
      }
    ],
    "host_header": "\${host}",
    "method": "round_robin"
  }'`} />

5. You'll receive a response similar to this, confirming the changes have been made:

```json
{
    "results": {
        "origin_id": <origin_id>,
        "origin_key": "<origin_key>",
        "name": "Default Origin (RR3)",
        "origin_type": "load_balancer",
        "addresses": [
            {
                "address": "example.com",
                "weight": 3,
                "server_role": "primary",
                "is_active": true
            },
            {
                "address": "example.net",
                "weight": 2,
                "server_role": "primary",
                "is_active": true
            },
            {
                "address": "example.org",
                "weight": 1,
                "server_role": "primary",
                "is_active": false
            }
        ]
        "host_header": "\${host}",
        "method": "round_robin"
        ...
    }
}
```

6. Wait a few minutes for the propagation to occur.

:::tip
Check the [Load Balancer API v3 documentation](https://api.azionapi.net/api/v3#/Origins) for more details.
:::
</Fragment>

</Tabs>


