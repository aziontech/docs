---
title: Rules Engine para Edge Firewall
description: Rules Engine para Edge Firewall
meta_tags: edge firewall, rules engine, rules engine para edge firewall, edge computing, firewall
namespace: documentation_products_edge_firewall_rules_engine
permalink: /documentacao/produtos/edge-firewall/rules-engine/
---

O **Rules Engine** foi elaborado para que você implemente sua lógica de segurança na edge. Com base em critérios programáveis, você escolhe o que deseja fazer.

Confira algumas das possibilidades do **Rules Engine** para você: bloquear uma requisição; ignorar uma requisição; limitar a taxa de acesso; aplicar uma política de WAF; executar uma edge function com seu próprio código de segurança; e ainda monitorar o tráfego para identificar ameaças. Saiba mais a seguir.

## Conhecendo o Rules Engine

### Como funciona

Cada requisição de seus usuários para sua aplicação é processada primeiro pelo **Edge Firewall**.

Você pode definir um conjunto de regras de segurança no **Edge Firewall**. As regras são compostas por critérios, que representam as condições para execução da regra, e por comportamentos, que representam as ações que precisam ser executadas.

O processamento das regras é sequencial e você pode utilizar como critérios um poderoso conjunto de variáveis e operadores de comparação. Caso as condições sejam atendidas, os comportamentos de cada regra são executados até que todas as regras sejam processadas ou se encontre uma regra com um comportamento finalizador no caminho – _Deny_ ou _Drop_.

## Regras

As regras são compostas sempre por condições – *criteria* – e comportamentos – *behaviors*. Você também pode adicionar uma *descrição* para sua regra.

### Descrição

Além do nome da regra, você pode adicionar uma descrição para ela usando o campo **Description**. Sua descrição ficará visível na lista de regras e pode ser usada para identificar o que a regra faz.

### Criteria

Determinam o conjunto de condições que precisam ser atendidas para a execução dos *Behaviors* – comportamentos.

#### Variáveis

| Criteria               | Descrição                                                    | Requisitos               |
| ---------------------- | ------------------------------------------------------------ | ------------------------ |
| Header Accept          | Cabeçalho que informa quais tipos de mídia que o cliente aceita para a resposta. | Web Application Firewall |
| Header Accept-Encoding | Cabeçalho que informa quais os tipos de codificação de conteúdo, geralmente algoritmos de compressão, que o cliente aceita para a resposta. | Web Application Firewall |
| Header Accept-Language | Cabeçalho que informa sobre a linguagem esperada.            | Web Application Firewall |
| Header Cookie          | Cabeçalho que contém os cookies enviados pelo cliente na requisição para o servidor. | Web Application Firewall |
| Header Origin          | Cabeçalho que informa a origem de uma requisição de acesso cross-site ou de uma requisição preflight. A origem é uma URI indicando o nome do servidor, sem nenhuma informação de caminho. | Web Application Firewall |
| Header Referer         | Cabeçalho que indica o endereço do documento, ou elemento em um documento, a partir do qual a URI da requisição foi obtido. | Web Application Firewall |
| Header User Agent      | Cabeçalho com uma sequência característica que permite que servidores identifiquem o aplicativo, sistema operacional, fornecedor e/ou versão do dispositivo. | Web Application Firewall |
| Hostname               | Em ordem de precedência: o *hostname* da linha de requisição, ou o valor do campo de cabeçalho *host* da requisição, ou o nome do servidor atendendo a requisição. | -                        |
| Network                | O endereço IP do cliente que está realizando a requisição HTTP, que poderá ser utilizado para qualquer comparação de rede (CIDR, ASN ou Country). | Network Layer Protection |
| Request Args           | Todos os argumentos enviados pelo usuário na linha de requisição (*query string*). | Web Application Firewall |
| Request Method         | O método HTTP da requisição. Por exemplo: GET, POST, PUT etc. | -                        |
| Request URI            | Refere-se à variável `uri` da Rules Engine for Edge Applications. O URI normalizado (urldecoded) da requisição. O valor de `uri` pode mudar durante o processamento de uma requisição, por exemplo, quando ocorre um redirecionamento interno ou quando são utilizados arquivos de índice. Ele NÃO carrega os parâmetros da Query String como `request_uri` faz. | -                        |
| *Scheme*               | O scheme da requisição: http ou https.                       | -                        |
| Client Certificate Validation | Processo do servidor para autenticar o certificado digital do cliente | - |

#### Operadores de Comparação

A condição para execução de uma regra deve ser a comparação de uma variável com um argumento. Os operadores de comparação são:


| Operador            | Descrição                                                    | Argumento                  |
| ------------------- | ------------------------------------------------------------ | -------------------------- |
| is equal            | O valor da variável é igual ao argumento, comparado caracter a caracter. | string                     |
| is not equal        | O valor da variável não é exatamente igual ao argumento.     | string                     |
| starts with         | O valor da variável inicia pelo argumento.                   | string                     |
| does not start with | O valor da variável não inicia pelo argumento.               | string                     |
| matches             | O valor da variável coincide com a expressão regular ou lista informada como argumento. | regular expression<br />list |
| does not match      | O valor da variável não coincide com a expressão regular ou lista informada como argumento. | regular expression<br />list |
| exists              | A variável tem valor definido. Por exemplo, Request Args existe se for enviado um argumento na query string da requisição. | -                          |
| does not exist      | A variável não tem valor definido. Por exemplo, Request Args não existe se não for enviado um argumento na query string da requisição. | -                          |

> **Observação**: As opções variam de acordo com o *Criteria* selecionado.

#### Operadores Lógicos

Múltiplas condições podem ser definidas por meio dos operadores lógicos "*and*" e "*or*". O operador "*and*" tem precedência implícita sobre o operador "*or*".

Se necessária precedência explícita, você pode adicionar múltiplos grupos de critérios sob a lógica "*and*".

### Behaviors

Em **Behavior** você adiciona os comportamentos que deseja executar caso as condições da regra sejam satisfeitas.

| Behavior                      | Descrição                                                    | Requisitos               |
| ----------------------------- | ------------------------------------------------------------ | ------------------------ |
| Deny (403 Forbidden)          | Encerra a requisição com resposta HTTP *403 Forbidden*.      | -                        |
| Drop (Close Without Response) | Encerra a requisição sem responder ao cliente.               | -                        |
| Set Rate Limit                | Define um limite de taxa de acesso que, se excedido, resultará em resposta HTTP *429 Too Many Requests*. Para configurar *Rate Limit*, você deverá informar: <br />**Type**, é o campo para selecionar o tipo de requisição do Rate Limit, optando por **Req/s** (Requisições por Segundo) ou **Req/Min** (Requisições por Minuto); <br />**Average Rate Limit**, que é a taxa limite por segundo, propriamente dita; <br />**Client IP address**, se você deseja que a contabilização da taxa de acesso seja por endereço **IP do cliente** ou **Global**, caso deseje contabilização total da taxa de acesso; <br />**Maximum burst size***, que indica o tamanho máximo da rajada de requisições HTTP enviadas simultaneamente, as quais serão enfileiradas e despachadas gradualmente, respeitando-se a taxa limite. <br />`* O Maixumum Burst size está disponível apenas para o tipo de requisição "Req/s" (Requisição por Segundo).`<br />O valor configurado será o Rate Limit em cada Azion Edge Node, implementado por meio do algoritmo de Leaky Bucket. Recomendamos que você utilize *Maximum burst size* no máximo 10 vezes o valor configurado em *Average Rate Limit*, o que resultaria em penalizar a última requisição de uma rajada com até 10 segundos de atraso.<br /> |                          |
| Set WAF Rule Set              | Associa a Rule Set de WAF que deve ser utilizada na requisição. As políticas de WAF devem ser previamente configuradas no menu *Edge Libraries > WAF Rules*. | Web Application Firewall |
| Run Function                  | Executa uma função especificada como parâmetro. A função deve ter sido previamente instanciada e parametrizada na aba Functions, para poder ser utilizada. | Edge Functions           |