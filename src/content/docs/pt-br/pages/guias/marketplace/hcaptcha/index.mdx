---

title: Como utilizar a solução hCaptcha através do Marketplace da Azion
description: A solução hCaptcha age como uma defesa contra ataques maliciosos de bots, SPAM e outros.
meta_tags: edge computing, captcha, hcaptcha, bot, spam
namespace: docs_use_case_hcaptcha
permalink: /documentacao/produtos/guias/hcaptcha/
---

hCaptcha é uma solução *serverless* disponível no Marketplace da Azion. Este tipo de solução é utilizada principalmente para proteger seus domínios contra bots, permitindo o monitoramento do tráfego em seu site através do Painel de Controle do site hCaptcha.

O hCaptcha é um serviço CAPTCHA que visa melhorar a privacidade e a segurança dos usuários usando quebra-cabeças mais difíceis de serem resolvidos pelos bots. Os quebra-cabeças resolvidos são usados posteriormente para treinar modelos de aprendizagem de máquina para melhorar a segurança geral da internet. 

O hCaptcha também permite aos proprietários de sites ganhar dinheiro exibindo esse tipo de quebra-cabeças para seus usuários.

---

## Obtendo a solução

Para usar a solução hCaptcha fornecida no Marketplace da Azion, você deve seguir os próximos passos:

1. Entrar na sua conta da Azion no [Real-Time Manager (RTM)](https://manager.azion.com/).
    - Se você ainda não tiver uma, [crie uma conta](https://manager.azion.com/signup/) visitando a página de cadastro.
2. No canto superior esquerdo da página, selecione **Products menu** > **Marketplace**.
3. Selecione a caixa de busca e digite "*hcaptcha*" ou navegue pelos cards para encontrar a solução hCaptcha.
4. Depois de encontrar o card hCaptcha, selecione-o para ir para a página da solução.
5. Na página da solução, procure a seção **Subscribe for** no canto inferior direito.
6. Clique no botão **Get It Now**.

> Você verá uma mensagem indicando que sua solução foi instalada com sucesso e está pronta para ser usada.

---

## Obtendo as credenciais no site hCaptcha

Para usar a solução hCaptcha, você deve fornecer duas chaves: sua secret-key e sua site-key. Para obter estas credenciais, você terá que se registrar no site hCaptcha. 

Para realizar isto, siga estes passos:

1. Vá para o [painel de controle do site hCaptcha](https://dashboard.hcaptcha.com/overview).
    - Se você não tiver uma conta, [você pode criar uma aqui](https://www.hcaptcha.com/signup-interstitial).
    - Atente-se ao criar uma nova conta, pois o site fornecerá sua secret-key. Esta secret-key será usada para configurar a solução mais tarde.
2. No painel de controle, clique no botão **New Site**.
3. É opcional, mas indicado, nomeá-la como sua instância de hCaptcha.
4. Preencha os `hostnames` nos quais você deseja usar o desafio e clique no botão **Add Domain**.
5. Escolha seu modo de desafio:
    - Você tem três opções aqui: **Always Challenge** (grátis), **Passive** (pago) e **99.9% Passive** (pago). A diferença entre os três modelos é a heurística aplicada em cada acesso; para o modo *Passive*, não há desafio e o CAPTCHA será acionado de acordo com o comportamento do usuário. Já no modelo *99,9% Passive*, o desafio só aparecerá para usuários com alto risco de serem bots. Por fim, para o modelo *grátis*, onde apenas o modo Always Challenge está disponível, cada pedido carregará um desafio.
6. Escolha o limiar de passagem desejado para seu site, de acordo com o nível de dificuldade: *auto (automático)*, *easy (fácil)*, *moderate (moderado)* e *difficult (difícil)*. Estes modos determinarão quão precisas as respostas do usuário devem ser para passar no teste.
7. Com tudo preenchido, clique no botão **Save** no canto superior direito.

Agora você tem seu site configurado para usar a solução hCaptcha. Para configurar nossa solução, ainda temos que obter a site key do hCaptcha. 

Para isso, siga os passos:

1. No painel de controle, no menu superior, clique em **Sites**.
2. Após carregar a tela com seus sites, escolha o que você configurou acima.
3. Clique no botão **Settings**, com o símbolo da engrenagem.
4. Você verá um campo de texto com uma cadeia de caracteres que terá este aspecto:
    - `efdb42c7-10ee-4969-8013-cfcb5f7ad007`. Esta é a sua site key.
5. Você pode clicar no botão **Try Out** para ver se tudo está funcionando.
6. Salve ambas as chaves para configurar a solução da Azion.

---

##  Usando a solução
### Criando uma regra dentro do Edge Firewall

Para instanciar a solução hCaptcha, siga estes passos:

1. Em **Products menu**, selecione **Edge Firewall** dentro da seção **SECURE**.
2. Clique no botão **Add Rule Set**.
3. Dê um nome fácil de lembrar à sua nova regra.
4. Selecione os domínios que você deseja proteger.
5. Habilite o switch de **Edge Functions**.
6. Clique no botão **Save**.

Pronto. Agora você instanciou uma regra para a sua solução.

---
### Configurando a solução

Para instanciar a solução hCaptcha, ainda na página do **Edge Firewall**, selecione a aba **Functions** e siga estes passos:

1. Clique no botão **Add Function**.
2. Dê um nome fácil de lembrar à sua instância.
3. No menu suspenso, selecione a função *hCaptcha*.

Esta ação irá carregar a função, mostrando um formulário com o código-fonte dela e, logo acima dele, duas abas: **Code** e **Args**. Ao clicar na aba **Code**, você poderá navegar pelo código, mas não poderá modificá-lo.

A aba **Args** carregará um arquivo JSON como o mostrado abaixo, onde você deverá passar suas credenciais, obtidas no site hCaptcha:

```json
{
    "site_key": "site-key",
    "secret_key": "private-key",
    "expiration_in_seconds": 86400,
    "domain": ".azion.com",
    "after_check_redirect_url": "https://www.azion.com",
    "cookie_secret": "KEY_16_CHAR_LONG"
}
```

Onde:
- `site_key`: a chave que você obteve na página hCaptcha.
- `secret_key`: a chave que você obteve na página hCaptcha.
- `expiration_in_seconds`: o tempo, *em segundos*, até que o hCaptcha expire.
- `domain`: seu domínio.
- `after_check_redirect_url`: domínio para o qual você deseja redirecionar depois que o usuário passar no teste hCaptcha.
- `cookie_secret`: este cookie é gerado pela function e utilizado para que as functions não voltem a ser executadas.

> Devido ao algoritmo utilizado na criptografia, a chave `cookie_secret` deve ter 16 ou 32 caracteres.

Clique no botão **Save** para salvar suas configurações. Agora sua instância da solução hCaptcha está salva.

*Opcionalmente*, você pode passar outros parâmetros para personalizar as mensagens que deseja em seu hCaptcha e um HTML personalizado para renderizar o desafio.

```json
{
    "custom_message": "My message",
    "custom_html": "<html>... <!-- azion_captcha -->  .. </html>",
    "captcha_args": {
        "theme": "dark",
        "size": "compact"
    }
}
```

Onde:
- `custom_message`: aqui você pode passar uma mensagem personalizada aos usuários.
- `custom_html`: aqui você pode passar um HTML personalizado para renderizar a caixa de desafio hCaptcha.
- `captcha_args`: você pode usar este parâmetro para modificar o layout da caixa de desafio para um diferente do padrão.

---

## Configurando o Rules Engine

Para finalizar o processo, é necessário configurar os parâmetros *behavior* (comportamento) e *criteria* (critério) para executar a função.

Ainda na página **Edge Firewall**, selecione a aba **Rules Engine** e siga estes passos:

1. Clique no botão **New Rule**.
2. Dê um nome para a regra.
3. Selecione um *criteria* para executar e selecione os domínios nos quais você deseja executar a solução. Exemplo: `if Hostname is equal xxxxxxxxxxxx.map.azionedge.net`.
4. Abaixo, selecione um behavior para o criteria indicado (você pode indicar mais de um clicando em *AND*). Neste caso, será **Run Function**.
    - Selecione a function reCaptcha, que aparecerá com o nome que você indicou no passo de instanciação.
5. Clique em **Save**.

Pronto. Agora a solução hCaptcha está em execução para cada solicitação feita ao domínio que você indicou.

