---

title: Como utilizar a solução IP Address Reputation através do Marketplace da Azion
description: A solução IP Address Reputation, da IPQS, protege seu site contra IPs maliciosos.
meta_tags: edge computing, IPQualityScore, IP Address Reputation
namespace: docs_use_case_ipaddress
permalink: /documentacao/produtos/guias/ipaddress/
---

A IPQualityScore fornece uma pontuação de reputação para um determinado endereço IP. A pontuação é baseada em vários fatores, incluindo se o endereço IP foi usado para spam ou outra atividade maliciosa, com que frequência este endereço foi denunciado como suspeito ou fraudulento, entre outras informações. Uma pontuação mais alta indica que o endereço IP tem melhor reputação e é menos provável que seja usado de forma maliciosa. Por outro lado, uma pontuação menor indica que o endereço IP tem mais probabilidade de ser usado para atividade maliciosa e deve ser usado com cautela.

---

## Obtendo a solução

Para obter a solução IP Address Reputation fornecida pelo **Marketplace**, siga esses passos:

1. Acesse sua conta no [Real-Time Manager (RTM)](https://manager.azion.com/).
    - Se você não tiver uma, crie uma conta [visitando a página de cadastro](https://manager.azion.com/signup/).
2. No canto superior esquerdo da página, selecione **Products Menu** > **Marketplace**.
3. Na caixa de busca Explore for solutions, digite *“ip”* ou navegue pelos cards para encontrar a solução IP Address Reputation.
4. Selecione o card IP Address Reputation. Você será redirecionado para a página da solução.
5. Na seção **Subscribe for**, localizada no canto inferior direito da tela, clique no botão **Get It Now**.

> Nota: uma mensagem indica que a solução foi instalada com sucesso.

---

## Usando a solução

A solução obtida no **Marketplace** é adicionada à sua lista de **Edge Functions**. Portanto, para usar a solução IP Address Reputation, você deverá criar uma nova edge application com a função recém-incorporada.

Para aprender como criar uma edge application, visite a [documentação de ponto de partida](/pt-br/documentacao/produtos/ponto-de-partida/).

Você também pode criar uma edge application selecionando **RTM** > **Products Menu** > **Edge Application** e seguir as instruções.

> Dica: também é possível utilizar uma edge application já existente.

---

## Obtendo uma chave API na IPQualityScore

Para usar a solução IP Address Reputation, você deve obter a chave API no site da IPQualityScore.

Para fazer isso, siga estes passos:

1. Crie uma conta no site da [IPQualityScore](https://www.ipqualityscore.com/create-account).
2. Aguarde o email com suas informações pessoais.
    - Neste email, você encontrará sua chave API. Essa é a única informação que você precisa para configurar sua solução.

---

## Configurando a solução

Após obter uma solução no Marketplace, é preciso configurá-la.

Para configurar a solução IP Address Reputation, complete os seguintes passos:

1. Acesse o [Real-Time Manager (RTM)](https://manager.azion.com/).
2. No canto superior esquerdo da página, selecione **Products Menu** > **Edge Application**.
3. Na lista de aplicações, selecione a edge application na qual deseja configurar a solução IP Address Reputation.
4. Certifique-se de habilitar o interruptor **Edge Functions** na página principal da sua edge application para permitir o uso da sua nova solução.
5. Clique no botão **Save** no canto inferior direito da página.

> Nota: aparecerá uma mensagem indicando que a edge application foi atualizada com sucesso.

Isto ativará a guia **Functions** em sua edge application. Agora você será capaz de instanciar a edge function IP Address Reputation em sua edge application.

---

## Instanciando a solução

Para instanciar uma IP Address Reputation, siga os passos abaixo:

1. Ainda na página **Edge Application**, selecione a aba **Functions** localizada na lista superior.
2. Clique no botão **Add Function**.
3. Escolha um nome fácil de lembrar para a sua função.
4. No menu suspenso de funções, selecione a função **IP Address Reputation**.
    - Isto irá carregar a função, mostrando uma caixa com o código da função e, logo acima, duas abas: **Code** e **Args**.

> Se você clicar na aba **Code**, será possível navegar pelo código para se familiarizar com ele, mas sem alterá-lo.

Na aba **Args**, você mudará a configuração de edge function IP Address Reputation. Para isso, selecione a aba **Args** para abrir a caixa de **Args**. Aqui, você pode adicionar os parâmetros para executar sua aplicação. Na aba **Args** você verá o arquivo `JSON` que você tem que editar para utilizar a solução. 

O `JSON` terá este aspecto:

```json
{
  "api_key": "XXXXXXXXXXXXXXXXXXXXXXXXXXX",
  "allow_public_access_points": true,
  "fast": true,
  "strictness": 0,
  "lighter_penalties": true,
  "user_language": "en-US",
  "transaction_strictness": 0
}
```

Para executar a solução, o único parâmetro que você precisará configurar é a `api_key`, passando a chave API que você recebeu por email.

Os outros campos são:

- `allow_public_access_points`: permite conexões públicas. O valor é um booleano, com o valor padrão sendo `true`.
- `fast`: habilita uma verificação rápida. Quando você habilita este parâmetro, sua API não faz algumas verificações forenses. O valor é um booleano, com o valor padrão sendo `true`.
- `strictness`: é o Fraud Scoring, valores mais altos (acima de 2) têm mais chances de retornar falsos positivos. Use o intervalo 0-3 para evitar este comportamento. O valor é um número inteiro, com o valor padrão sendo 0.
- `lighter_penalties`: reduz a pontuação para endereços IP sob um proxy, evitando falsos positivos. O valor é um booleano, com o valor padrão sendo `true`.
- `user_language`: o idioma do cabeçalho do usuário. O valor é uma string, sem valor padrão.
- `transaction_strictness`: ajusta os pesos das penalidades para irregularidades e padrões de fraude detectados. Este recurso só é útil quando são fornecidos detalhes de pedidos e transações. O valor é um número inteiro, sem valor padrão.

Alguns outros parâmetros, que não estão no exemplo `JSON` fornecido na caixa Args, podem ser utilizados. 

Eles são:

- `when_score_above`: estabelece um limiar de pontuação. Sempre que o IPQS Risk Score exceder este limite, a função executará a ação definida pelo argumento `execute`. Se o valor não for definido, nenhuma ação será tomada pela função. O valor é um número inteiro, sem valor padrão.
- `execute`: a ação que será executada quando o limiar de pontuação for ultrapassado. O valor é uma string, que aceita três possibilidades: `deny`, `drop`, `add_header`. Não existe um valor padrão.
- `get_data_from`: determina se o IP será recuperado por uma querystring request do header ou do body. Se o valor for `remote_addr`, o valor a ser extraído será: `ngx.var.remote_addr`. O valor é uma string com quatro possibilidades: `remote_addr`, `querystring`, `body`, `header`. O valor padrão é `remote_addr`.
- `data_name`: identifica o campo ou argumento de onde a função IPQS irá extrair o IP para validar. Este parâmetro só é usado se o parâmetro `search_in` é diferente de `remote_addr`. O valor é uma string, com o valor padrão sendo `X-Forwarded-For`.

---

## Definindo uma regra para o Rules Engine

Ainda na página de **Edge Application**, na aba **Rules Engine**, você deve configurar as regras (*criteria* e *behavior*) que deseja aplicar a fim de executar sua função.

Para fazer isso, siga estes passos:

1. Na página **Edge Application**, selecione a aba **Rules Engine**.
2. Clique em **Default Rule**.
3. No campo *behavior*, selecione **Run Function** no menu suspenso e depois selecione a opção **IP Address Reputation**, de acordo com o nome que você deu na etapa de instanciação.

> Nota: você não pode alterar o campo de criteria para a Default Rule.

4. Clique no botão **Save**.

---

#### Importante

É uma boa prática criar outra regra, redirecionando sua aplicação para outra URL, porque, se a solução IP Address Reputation não encontrar erros, você não verá nenhuma mensagem. Se você não quiser ou precisar, você pode acompanhar o uso de sua chave API através do painel da IPQualityScore. Cada atualização em sua aplicação no edge contará como um novo pedido de busca de endereço IP. Note também que, para cada campo presente nos resultados, a solução adiciona o prefixo `IPQS` ao cabeçalho da solicitação. Isto significa que para cada consulta, o cabeçalho terá um prefixo com o campo. Por exemplo, se a solicitação tiver um campo `ASN`, o cabeçalho terá um cabeçalho com o prefixo `IPQS-ASN` com o mesmo valor. Você também pode utilizar estas informações para criar e gerenciar suas decisões no Rules Engine. Você pode encontrar uma [lista completa destes campos aqui](https://www.ipqualityscore.com/documentation/proxy-detection/overview).


