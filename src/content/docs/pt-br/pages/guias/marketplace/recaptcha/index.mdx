---

title: Como utilizar a solução reCaptcha através do Marketplace da Azion
description: A solução reCaptcha protege contra ataques mal intencionados de bots, SPAM e outros.
meta_tags: edge computing, recaptcha, captcha, spam, bots
namespace: docs_use_case_recaptcha
permalink: /documentacao/produtos/guias/recaptcha/
---

reCaptcha é uma solução CAPTCHA (*Completely Automated Public Turing test to tell Computers and Humans Apart*) projetada para proteger websites contra bots e scripts automatizados usando um teste de resposta a desafios para determinar se o usuário é um humano ou uma máquina.

O Google mantém e é proprietário da reCaptcha. A solução do Google existe há muito tempo e o Google utiliza os dados coletados pela reCaptcha para melhorar seus serviços.

Dentre as muitas características que você encontrará na reCaptcha, é possível destacar as seguintes:

- Integração da API, que permite aos proprietários do site implementar o reCaptcha em seu site.
- Diferentes tipos de desafios, tais como desafios baseados em imagem e áudio, que podem ser personalizados de acordo com as necessidades do site.
- Recursos de segurança, tais como limitação de taxas e bloqueio automático de tráfego suspeito, que ajudam a proteger seus ativos contra bots e scripts automatizados.
- Opções de acessibilidade para usuários com deficiência visual, tais como uma versão em áudio do desafio.

---

## Obtendo a solução

reCaptcha é uma solution *serverless* disponível no Marketplace da Azion. Este tipo de solução é utilizado principalmente para proteger seus domínios contra bots, permitindo o monitoramento do tráfego em seu site através do Painel de Controle do Google para reCaptcha.

Para usar a solução reCaptcha fornecida no Marketplace da Azion, você deve seguir os seguintes passos:

1. Entre na sua conta do [Real-Time Manager (RTM)](https://manager.azion.com/).
    - Se você ainda não tiver uma, [crie uma conta](https://manager.azion.com/signup/) visitando a página de cadastro.
2. No canto superior esquerdo da página, selecione **Products menu** > **Marketplace**.
3. Selecione a caixa de busca e digite "*recaptcha*" ou navegue pelos cards para encontrar a solução reCaptcha.
4. Depois de encontrar o card reCaptcha, selecione-o para ir para a página da solução.
5. Na página da solução, procure a seção **Subscribe for** no canto inferior direito.
6. Clique no botão **Get It Now**.

> Você verá uma mensagem indicando que sua solução foi instalada com sucesso e está pronta para ser usada.

---

## Obtendo as credenciais no site do Google

Para usar a solução reCaptcha, você deve fornecer duas chaves: sua `private-key` e sua `site-key`. 

Para obter estas credenciais, você terá que se registrar no Google. 

Para fazer isto, siga estes passos:

1. Vá para o [painel de administração do Google reCaptcha](https://developers.google.com/recaptcha).
    - Se você não tiver uma Conta Google, você será solicitado a criar uma.
2. Uma vez inscrito, você será redirecionado para a página de registro no site.
3. Nesta página, você deve preencher:
    - Um nome para seu novo site que vai usar o reCaptcha.
    - Qual versão do reCaptcha você deseja usar (você pode escolher entre v2 ou v3).
        - Caso escolha a v2, você será solicitado a escolher que tipo de teste você deseja aplicar em seu site. As opções são: *I'm not a robot checkbox*, *Invisible reCaptcha*, e *reCaptcha Android*.
        > **Importante**: tenha em mente que a solução de reCaptcha do Marketplace da Azion foi concebida para ser usada com a opção v2 Invisible reCaptcha.
    - Indique em qual domínio você deseja executar o reCaptcha (lembre-se de ignorar o `http://` ou `https://` para o nome de domínio).
    - Você deve aceitar os termos de serviço do reCaptcha.
    - Você pode escolher se deseja receber alertas do Google sobre seu site, tais como configurações erradas e outros.
4. Após preencher todas as informações, clique no botão **Submit**.

Agora você tem seu site registrado para usar o reCaptcha. Na tela seguinte, você receberá duas chaves: `Site-Key` e `Secret-Key`.

Estas duas chaves serão usadas para configurar a solução reCaptcha da Azion mais tarde.

---

## Usando a solução

A solução obtida no Marketplace é adicionada à sua lista de edge functions. Esta solução roda sob o Edge Firewall da Azion. Deste modo, você deve configurar o edge firewall para rodar a sua solução recém-adquirida.

### Criando uma regra dentro do Edge Firewall (#criando-regras)

Para instanciar a solução reCaptcha, siga estes passos:

1. Em **Products menu**, selecione **Edge Firewall** dentro da seção **SECURE**.
2. Clique no botão **Add Rule Set**.
3. Dê um nome fácil de lembrar para a sua nova regra.
4. Selecione os domínios que você deseja proteger.
5. Habilite o switch **Functions** para habilitar que você rode edge functions no seu edge firewall.
6. Clique no botão **Save**.

Pronto. Você instanciou uma regra para a sua solução.

### Configurando a solução

Para instanciar a solução reCaptcha, ainda na página do **Edge Firewall**, selecione a aba **Functions** e siga estes passos:

1. Clique no botão **Add Function**.
2. Dê um nome fácil de lembrar para a sua instância.
3. No menu suspenso, selecione a função *reCaptcha*.

> Depois de selecionar a solução, um form com o código-fonte, chamado **Code** será carregado dentro da própria aba Code. Este é apenas para estudo e não pode ser modificado.

No mesmo form, você tem outra aba: **Args**. Nessa aba, você passará as credenciais que obtivemos na página reCaptcha do Google.

A aba Args carregará um arquivo JSON que se parece com este:

```json
{
    "site_key": "site-key",
    "secret_key": "private-key",
    "expiration_in_seconds": 86400,
    "domain": ".azion.com",
    "after_check_redirect_url": "https://www.azion.com",
    "cookie_secret": "KEY_16_CHAR_LONG"
}
```
Onde:
- `site_key`: a chave que você obteve na página reCaptcha do Google.
- `secret_key`: a chave que você obteve na página reCaptcha do Google.
- `expiration_in_seconds`: o tempo, *em segundos*, até que o reCaptcha expire.
- `domain`: seu domínio.
- `after_check_redirect_url`: domínio para o qual você deseja redirecionar depois que o usuário passar no teste reCaptcha.
- `cookie_secret`: este cookie é gerado pela function e utilizado para que as functions não voltem a ser executadas. 

> Devido ao algoritmo utilizado na criptografia, a chave `cookie_secret` deve ter 16 ou 32 caracteres.

4. Clique no botão **Save**.

Pronto. Agora sua instância da solução reCaptcha está salva.

*Opcionalmente*, você pode passar outros parâmetros para personalizar as mensagens que deseja em seu reCaptcha e um HTML personalizado para renderizar o desafio.

```json
{
    "custom_message": "My message",
    "custom_html": "<html>... <!-- azion_captcha -->  .. </html>"
}
```

Onde:
- `custom_message`: aqui você pode passar uma mensagem personalizada aos usuários.
- `custom_html`: aqui você pode passar um HTML personalizado para renderizar a caixa de desafio reCaptcha.

---

## Configurando o Rules Engine

Para finalizar o processo, é necessário configurar os parâmetros *behavior* (comportamento) e *criteria* (critério) para executar a função.

Ainda na página **Edge Firewall**, selecione a aba **Rules Engine** e siga estes passos:

1. Clique no botão **New Rule**.
2. Dê um nome fácil de lembrar para a sua regra.
3. Selecione um *criteria* para executar e selecione os domínios nos quais você deseja executar a solução. Exemplo: `if Hostname is equal xxxxxxxxxxxx.map.azionedge.net`.
4. Abaixo, selecione um *behavior* para o *criteria* indicado (você pode indicar mais de um clicando em *AND*). Neste caso, será **Run Function**.
    - Selecione a function reCaptcha, que aparecerá com o nome que você indicou no passo de instanciação.
5. Clique em **Save**.

Pronto. Agora a solução reCaptcha está em execução para cada solicitação feita ao domínio que você indicou.


