---
title: Como instalar a integração Azion Bot Protection através do Marketplace da Azion
description: Azion Bot Protection é uma integração serverless que utiliza edge functions no Edge Firewall para analisar requisições recebidas e atribuir uma pontuação com base em regras e comportamentos e prevenir possíveis ataques.
meta_tags: bot, protection, cibersegurança, edge computing, SIEM
namespace: docs_use_case_bot_protection
permalink: /documentacao/produtos/guias/bot-protection/
---
import Badge from '~/components/Badge.astro';

<Badge variant="accent">
Preview
</Badge>

Azion **Bot Protection** é uma integração *serverless* disponível no [Marketplace da Azion](). Esta integração analisa requisições recebidas usando uma edge function, executada no **Edge Firewall**, e atribui uma pontuação com base em regras e comportamentos.

Se a pontuação exceder um limite predeterminado, a integração declina ou cancela a requisição. Usando algoritmos avançados que analisam o comportamento dos dados recebidos, ela pode detectar e impedir atividades maliciosas, como preenchimento de credenciais, varredura de vulnerabilidades e site scraping.

O sistema emprega o algoritmo de *Reputation Intelligence* a fim de estabelecer o perfil de cada pessoa que visita o site, incluindo localização, tipo de dispositivo e padrões de navegação. Isso permite a identificação instantânea de comportamentos suspeitos e, assim, ações preventivas contra possíveis ataques.

---

## Obter a integração

Para obter a integração, siga estes passos:

Para utilizar a integração, acesse no [Real-Time Manager (RTM)](/pt-br/documentacao/produtos/guias/como-acessar-o-rtm/) e vá para o **Marketplace**.

Na página inicial do Marketplace, selecione o card correspondente à integração Azion **Bot Manager**.

Quando esteja na página da integração, clique no botão **Get It Now**, no canto inferior direito, e uma mensagem aparecerá indicando que a integração foi instalada com sucesso.

:::tip
Você pode procurar qualquer integração navegando pelos cards ou digitando uma palavra-chave na barra de busca.
:::

---

## Configurar a integração

### Configurar uma regra no Edge Firewall

Para instanciar a integração **Azion Bot Protection**, siga estes passos:

1. No canto superior esquerdo da página, selecione **Products menu** > **Edge Firewall**, dentro da seção **SECURE**.
2. Clique no botão **Add Rule Set**.
3. Dê um nome fácil de lembrar à sua nova regra.
4. Selecione os domínios que deseja proteger com a função.
5. Habilite o switch **Edge Functions** na seção **Edge Firewall Modules**.
6. Clique no botão **Save**.

Pronto. Você instanciou a regra para sua função e habilitou o uso de edge functions para seu edge firewall.

### Configurar a função

Ainda na página do **Edge Firewall**:

1. Selecione a aba **Functions**.
2. Clique no botão **Add⁠ Function**.
3. Dê um nome fácil de lembrar à sua instância.
4. No menu suspenso, selecione a função **Azion Bot Protection**.

Esta ação carregará a função, mostrando um formulário com o código-fonte desta e, logo acima dele, duas abas: **Code** e **Arguments**. Na aba **Arguments**, você passará suas variáveis.

Mesmo quando `threshold` e `action`são as variáveis obrigatórias a serem definidas, você pode adicionar e definir mais variáveis, de acordo com sua necessidade, conforme mostrado no exemplo a seguir.

```json
{
  "threshold": 10,
  "action": "deny",
  "disabled_rules": [],
  "reputation_network_lists": [2357, 2358, 2358, 2360],
  "log_tag": "log_tag",
  "siem_integration": true,
  "send_data_to_siem_when": "always",
  "siem_connection_args": {
    "host": "example.com",
    "uri": "/inspect/",
    "port": "443",
    "scheme": "https",
    "additional_headers": {
      "X-Test": "something goes here",
      "X-Another-Test": "Another thing goes here"
    }
  }
}
````

Onde:

| Variable | Type | Required | Description |
|---|---|---|---|
| `threshold` | Number | **** | Defines a maximum score that the request can reach before the function takes an action. Whenever it has not value, the function won't take action.|
| `action` | String | Yes | Defines an action to be taken by the function whenever the request's score is greater or equals the defined threshold. Possible values: `deny`, `drop`, and `log`.  |
| `disabled_rules` |   |   |   |
| `reputation_network_lists` |   |   |   |
| `log_tag` |   |   |   |
| `siem_integration` |   |   |   |
| `send_data_to_siem_when` |   |   |   |
| `siem_connection_args` |   |   |   |
| `host` |   |   |   |
| `uri` |   |   |   |
| `port` |   |   |   |
| `scheme` |   |   |   |
| `additional_headers` |   |   |   |
| `X-Test` |   |   |   |
| `X-Another-Test` |   |   |   |


Quando estiver pronto, clique no botão **Save** para salvar suas configurações.

:::tip
Para saber como obter os logs de Azion **Bot Protection**, acesse a seção [Integrar com um SIEM](#integrar-com-um-siem).
:::

### Configurar o Rules Engine

Para concluir, você precisa configurar o **Rules Engine** e nele configurar o *behavior* (comportamento) e os *criteria* (critérios) para executar a integração.

Ainda na página **Edge Firewall**:

1. Selecione a aba **Rules Engine**.
2. Clique no botão **New Rule**.
3. Dê um nome fácil de lembrar à sua nova regra.
   - Você pode adicionar uma descrição, mas é um passo opcional.
4. Selecione um *criteria* (critério) para executar a integração:
   - Use esta regra: `if Request URI does not match "\.(png|jpg|css|js|jpeg|gif|ico|ttf|svg|woff|woff2|ashx|asmx|svc|swf|otf|eot)(\?.*)?$"`
      - Esta regra é necessária para excluir todos os dados estáticos.
5. Você precisa criar outro critério para que esta integração funcione: `if Request URI does not match /.well-know/`
   - Essa regra é necessária para criar uma lista de permissões de IP que não impacte a automação ou scripts da WEB API.
6. Abaixo, selecione o *behavior* (comportamento) para os *criteria* (critérios). Nesse casso será **Run Function**
  - Selecione a função **Azion Bot Protection** de acordo com o nome que você deu antes.
7. Clique no botão **Save**.

Pronto. Agora você tem seus domínios protegidos contra ataques de bot usando a integração Azion **Bot Protection**.

---

## Integrar com um SIEM

Se você precisar dos logs do **Bot Protection**, você pode entrar em uma plataforma SIEM para obter estes dados. Para isso, na aba **Argumentss**, atualize a função e insira os dados da conexão com o SIEM.

### Exemplo de conexão SIEM

```json
{
"siem_integration": true,
  "send_data_to_siem_when": "always",
  "siem_connection_args": {
    "host": "requestinspector.com",
    "uri": "/inspect/01g43ftztkqgvcr65pjwbr0227",
    "port": "443",
    "scheme": "https",
    "additional_headers": {
      "Authorization": "secret123"
      }
   }
}
```

### Log example

```json
{
  "geoip_region": "SP",
  "action": "deny",
  "asn": "396982",
  "request_id": "9581e2b51b5a082b12fed308f4eae564",
  "host": "ojgayey.map.azionedge.com",
  "classified": "bad bot",
  "geoip_country": "BR",
  "http_user_agent": "curl/7.87.0",
  "bot category": [
    "Bad Bot Signatures"
  ],
  "request_uri": "/a",
  "remote_addr": "34.95.175.91",
  "score": 8
}
```

Onde: 

| Variável  | Descrição  |
|---|---|
| `geoip_region` |   |
| `action` |   |
| `asn` |   |
| `request_id` |   |
| `host` |   |
| `classified` |   |
| `geoip_country` |   |
| `http_user_agent` |   |
| `bot category` |   |
| `request_uri` |   |
| `remote_addr` |   |
| `score` |   |

---

## Importante

A Azion fornecerá configurações básicas e fáceis de usar, que devem ser suficientes para a maioria dos casos. Se você precisar de uma configuração mais detalhada, você pode editar o arquivo `JSON` da integração.

Para encontrar esse arquivo:

1. Na página inicial do RTM, selecione o **Products menu**, indicado pelas três linhas horizontais no canto superior esquerdo.
2. Na seção **SECURE**, selecione **Edge Firewall**. 
3. Localize a edge function da Azion **Bot Protection** e clique nela para carregar o formulário contendo o código-fonte da integração.
4. Selecione a aba **Arguments**.

Isso carregará um arquivo `JSON` onde você poderá ajustar os parámetros de acordo com as necessidades do seu negócio.

import ContributorList from '~/components/ContributorList.astro'

**Contribuidores** <ContributorList>Contributor</ContributorList>
