---
title: Como encontrar o score de requisições bloqueadas pelo WAF
description: Aprenda como encontrar mais informações sobre requisições bloqueadas pelo WAF na Azion.
meta_tags: web application firewall, waf, azion, waf score, real-time events, edge firewall
namespace: documentation_products_guides_how-to_find_waf_score
permalink: /documentacao/produtos/guias/como-encontrar-score-de-requisicoes-bloqueadas-pelo-waf
---

O **Web Application Firewall (WAF)** da Azion gera resultados relevantes para a manutenção da segurança de suas edge applications. Essas informações podem ser acessadas através **Real-Time Events**, utilizando consultas (*queries*) específicas.

Real-Time Events é uma ferramenta de Observe, que permite a exibição de dados de suas edge applications na Azion, em tempo real. Acesse a documentação do [Real-Time Events](pt-br/documentacao/produtos/real-time-events/) para mais informações sobre o produto.

Este guia inclui algumas consultas do WAF disponíveis no Real-Time Events, que podem ser utilizadas para acessar os dados de requisições bloqueadas pelo WAF e com isso, entender o motivo pelo qual foram bloqueadas, resolver problemas e identificar possíveis falsos positivos.

## Queries do WAF no Real-Time Events

Para encontrar informações de requisições bloqueadas pelo WAF no Real-Time Events, siga os passos:

1. Acesse o [Real-Time Manager (RTM)](https://manager.azion.com).
2. Abra o **Products Menu**, indicado pelas três linhas horizontais e clique em **Real-Time Events**.
3. No campo **Data Source**, selecione **Edge Applications**.
4. No menu dropdown, ao lado de **Data Source**, defina o intervalo de tempo desejado (exemplo: requisições feitas nos últimos `15 minutos`, ou escolha um período entre datas).
5. No campo **Filter by**, escreva as as queries de busca.

Veja dois exemplos de queries que podem ser utilizadas para encontrar requisições barradas pelo WAF:

`host = 'domain.com' AND waf_attack_action = '$BLOCK'`

`host = 'domain.com' AND status = '400' AND upstream_status = '0'`

Em ambos exemplos, substitua `domain.com` pelo domínio da sua edge application.

6. Clique no botão **Search**.
    > Os resultados desses dois comandos serão semelhantes, mas é possível encontrar pequenas variações entre as respostas.

7. Selecione e clique em um dos resultados da lista para acessar todos os dados referentes a essa requisição.

Após rodar esses comandos e selecionar uma requisição, inúmeros dados serão exibidos. No entanto, no contexto do WAF, analisaremos os campos `status`, `upstream_status`, `waf_attack_action`, `waf_block`, `waf_headers`, `waf_learning`, `waf_match` e `waf_score`. Veja, na tabela abaixo, a definição de cada um desses campos.

| Campo               | Descrição                                                                                                                            |
|---------------------|--------------------------------------------------------------------------------------------------------------------------------------|
| `status`            | Status retornado para o usuário autor da requisição. Tipicamente, requisições bloqueadas pelo WAF retornam status 400 (Bad Request). |
| `upstream_status`   | É a resposta do servidor de origem da aplicação. Pode ser 0 ou a mesma resposta do status (campo acima). Se for 0 significa que a requisição nem chegou no servidor de origem (por não precisar, em casos da aplicação já estar em cache nas Edge Nodes da Azion, ou quando for boqueada pelo WAF). |
| `waf_attack_action` | Ação tomada pelo WAF.                                                                                                                |
| `waf_attack_family` | Em qual família de ameaças essa requisição foi enquadrada.                                                                           |
| `waf_block` | Booleano `1` ou `0`. O valor `1` indica que a requisição foi bloqueada pelo WAF, se o mesmo estiver configurado em modo `blocking`. Já `0` indica que não foi bloqueada pelo WAF. |
| `waf_headers`       | Headers da requisição, codificados em Base64.                                                                                        |    
| `waf_learning`      | Booleano (1 ou 0). O valor `1` indica que o WAF está operando em modo learning e o valor `0`, que está em modo blocking.             |
| `waf_match`         | Indica onde foram encontrados os sinais de ameaça detectados pelo WAF. O valor desse campo contém ID da possível família de ameaças e localização de onde foram encontrados as possíveis tentativas de ataque. Exemplo: `0:10:ARGS:state`. Nesse caso, temos, o ID da família de ameaças (10), a localização do código suspeito, nos argumentos (ARGS), especificamente no argumento `state` (state). |                       
| `waf_score`         | Valor final após cálculo de todos os indicativos de ameaças.                                                                         |

Quanto maior o valor do campo `waf_score`, mais indicativos de ameaças foram encontrados nesta requisição. Se o resultado for `-` significa que nenhum indicativo de ameaça foi encontrado. Por esse motivo, quanto mais rígido for o nível de sensibilidade definido no seu WAF, maior será a quantidade de requisições barradas com `waf_score` baixo.

Consulte os scores referentes a cada nível de sensibilidade disponível na documentação do [Web Application Firewall](pt-br/documentacao/produtos/edge-firewall/web-application-firewall/).

Para saber se seu WAF está operando em modo learning ou blocking, você pode usar este mesmo método e checar campo `waf_learning`, ou veja o guia [Como verificar o modo do seu WAF](pt-br/documentacao/produtos/guias/como-verificar-modo-do-seu-waf/).